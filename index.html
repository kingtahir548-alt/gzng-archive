<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†ÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒ Ø¨Û† Ú¯ÙˆÙ†Ø¬Ø§Ù†Ø¯Ù†ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©Û•ÛŒØ´Ù† --- */
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
            --radius: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans Arabic', sans-serif;
            background-color: var(--bg-color);
            background-image:
                radial-gradient(at 0% 0%, rgba(79, 70, 229, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(236, 72, 153, 0.1) 0px, transparent 50%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .container { max-width: 1200px; margin: 0 auto; display: none; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Ø³Û•Ø±Ù¾Û•Ú• (Header) --- */
        header {
            background: var(--card-bg);
            padding: 40px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, var(--primary), #ec4899);
        }

        h1 { 
            color: var(--text-dark); 
            font-size: 2.5em; 
            margin-bottom: 10px; 
            font-weight: 900;
            letter-spacing: -1px;
        }
        .subtitle { color: var(--text-gray); font-size: 1.1em; font-weight: 500; }

        /* --- Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù†ÛŒ Ú¯Û†Ú•ÛŒÙ† (Tabs) --- */
        .nav-tabs {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 30px;
            background: white; padding: 8px; border-radius: 50px; width: fit-content; margin-left: auto; margin-right: auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            flex-wrap: wrap; /* Ø¨Û† Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        }
        .tab-btn {
            background: transparent; color: var(--text-gray); border: none;
            padding: 10px 20px; border-radius: 40px; font-size: 15px; font-weight: 700;
            cursor: pointer; transition: all 0.3s ease;
            font-family: 'Noto Sans Arabic', sans-serif;
            white-space: nowrap; /* Ø¨Û† Ú¯Ø±ØªÙ†ÛŒ Ù†ÙˆÙˆØ³ÛŒÙ†Û•Ú©Û• Ø¨Û• ÛŒÛ•Ú© Ù‡ÛÚµ */
        }
        .tab-btn.active {
            background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        .tab-btn:hover:not(.active) { background: #f1f5f9; color: var(--text-dark); }

        /* --- Ø¨Û•Ø´ÛŒ Ú¯Û•Ú•Ø§Ù† Ùˆ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† --- */
        .controls {
            background: white; padding: 10px; border-radius: 16px; margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; gap: 10px; flex-wrap: wrap;
            align-items: center;
        }
        .search-box {
            flex: 1; padding: 12px 20px; border: 2px solid #e2e8f0; border-radius: 12px; 
            font-size: 15px; font-family: 'Noto Sans Arabic', sans-serif; transition: 0.3s;
            background: #f8fafc;
        }
        .search-box:focus { border-color: var(--primary); background: white; outline: none; }
        
        .add-btn {
            background: linear-gradient(135deg, var(--primary) 0%, #4338ca 100%);
            color: white; border: none; padding: 12px 25px;
            border-radius: 12px; font-size: 15px; font-weight: bold; cursor: pointer; 
            transition: all 0.3s; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
            display: flex; align-items: center; gap: 8px; font-family: 'Noto Sans Arabic', sans-serif;
        }
        .add-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(79, 70, 229, 0.3); }

        /* --- Ú©Ø§Ø±ØªÛ•Ú©Ø§Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ (Ù‡Û•Ù…Ø§Ù† Ø¯ÛŒØ²Ø§ÛŒÙ†ÛŒ Ù¾ÛØ´ÙˆÙˆ) --- */
        .activities-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px;
        }
        .activity-card {
            background: var(--card-bg); border-radius: 24px; overflow: hidden;
            box-shadow: var(--shadow); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(0,0,0,0.03); position: relative; display: flex; flex-direction: column;
        }
        .activity-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15); }
        
        .activity-header { padding: 20px; background: white; }
        .activity-header h3 { font-size: 1.4em; color: var(--text-dark); margin-bottom: 8px; }
        .activity-meta { display: flex; justify-content: space-between; font-size: 0.9em; color: var(--text-gray); }
        
        .images-container {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 2px; 
            height: 240px; overflow: hidden; background: #f1f5f9;
        }
        .activity-image {
            width: 100%; height: 100%; object-fit: cover; cursor: zoom-in; transition: 0.3s;
        }
        .activity-notes { 
            padding: 20px; color: #475569; font-size: 0.95em; line-height: 1.7; 
            background: #fcfcfc; flex-grow: 1; border-top: 1px solid #f1f5f9;
        }
        
        .card-footer {
            padding: 15px 20px; background: white; border-top: 1px solid #f1f5f9; text-align: right;
        }
        .delete-btn {
            background: #fee2e2; color: #ef4444; border: none; padding: 8px 15px; 
            border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.85em; 
            transition: 0.2s; font-family: 'Noto Sans Arabic', sans-serif;
        }
        .delete-btn:hover { background: #fecaca; }

        /* --- Ù„ÛŒØ³ØªÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù† (Ù‡Û•Ù…Ø§Ù† Ø¯ÛŒØ²Ø§ÛŒÙ†ÛŒ Ù¾ÛØ´ÙˆÙˆ) --- */
        .teachers-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; display: none;
        }
        
        /* --- ÙÛ†Ø±Ù… Ùˆ Ù…Û†Ø¯Ø§Úµ --- */
        .modal, .image-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(5px);
            z-index: 1000; justify-content: center; align-items: center; padding: 20px;
        }
        .modal.active, .image-modal.active { display: flex; animation: zoomIn 0.3s ease; }
        
        .modal-content {
            background: white; border-radius: 24px; padding: 35px; max-width: 550px; width: 100%;
            max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .modal-content h2 { margin-bottom: 25px; color: var(--text-dark); font-weight: 900; text-align: center; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #475569; font-size: 0.95em; }
        .form-group input, .form-group textarea, .form-group select { /* Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø³ÛÙ„ÛÚ©Øª */
            width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px;
            font-size: 15px; font-family: 'Noto Sans Arabic', sans-serif; transition: 0.3s; background: #f8fafc;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--primary); background: white; outline: none; }
        
        .save-btn {
            background: var(--primary); color: white; border: none; padding: 15px; 
            border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; 
            width: 100%; margin-top: 10px; font-family: 'Noto Sans Arabic', sans-serif;
            transition: 0.3s;
        }
        .save-btn:hover { background: #4338ca; }

        /* --- Ù†Û†ØªÛŒÙÛŒÚ©Û•ÛŒØ´Ù† --- */
        #notificationContainer {
            position: fixed; top: 20px; right: 20px; z-index: 1001;
        }
        .toast {
            background-color: #333; color: white; padding: 15px 25px; border-radius: 10px;
            margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); opacity: 0;
            transition: opacity 0.5s, transform 0.5s; transform: translateX(100%);
            display: flex; align-items: center; gap: 10px; font-weight: bold;
        }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.success { background-color: #10b981; }
        .toast.error { background-color: #ef4444; }

        /* --- Ù‚ÙˆÙÚµÛŒ Ù¾Ø§Ø±ÛØ²Û•Ø±ÛŒ (Ù‡Û•Ù…Ø§Ù† Ø¯ÛŒØ²Ø§ÛŒÙ†ÛŒ Ù¾ÛØ´ÙˆÙˆ) --- */
        #securityOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            z-index: 10000; display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        /* Loading & other styles unchanged */
        #globalLoader {
            position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            color: var(--primary); font-weight: bold; font-family: 'Noto Sans Arabic';
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Custom Confirmation Modal (Replaces window.confirm) */
        .confirm-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); z-index: 2000; justify-content: center; align-items: center;
        }
        .confirm-content {
            background: white; padding: 30px; border-radius: 15px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 350px; width: 90%;
        }
        .confirm-content h3 { color: #ef4444; margin-bottom: 20px; font-weight: 800; }
        .confirm-buttons button {
            padding: 10px 20px; border: none; border-radius: 10px; margin: 0 10px;
            cursor: pointer; font-weight: bold; font-family: 'Noto Sans Arabic', sans-serif;
            transition: 0.3s;
        }
        .confirm-yes { background: #ef4444; color: white; }
        .confirm-no { background: #e5e7eb; color: #4b5563; }
        .confirm-yes:hover { background: #dc2626; }
        .confirm-no:hover { background: #d1d5db; }
    </style>
</head>
<body>
    <!-- Ù‚ÙˆÙÚµÛŒ Ù¾Ø§Ø±ÛØ²Û•Ø±ÛŒ -->
    <div id="securityOverlay">
        <div class="security-box">
            <h2>ğŸ”’ Ù†Ø§ÙˆÚ†Û•ÛŒ Ù¾Ø§Ø±ÛØ²Ø±Ø§Ùˆ</h2>
            <p>ØªÚ©Ø§ÛŒÛ• ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ø¨Ù†ÙˆÙˆØ³Û•</p>
            <input type="password" id="sitePassword" class="security-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
            <button onclick="checkPassword()" class="security-btn">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <p id="errorMsg" style="color:#ef4444; margin-top:15px; display:none; font-weight:bold;">ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ù‡Û•ÚµÛ•ÛŒÛ•!</p>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§ÚµÛŒ Ù„Û†Ø¯Ú©Ø±Ø¯Ù† -->
    <div id="globalLoader">
        <div style="width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px;"></div>
        Ù„Û• Ù„Û†Ø¯Ú©Ø±Ø¯Ù†Ø¯Ø§ÛŒÛ•...
    </div>

    <!-- Ø´ÙˆÛÙ†ÛŒ Ù†Û†ØªÛŒÙÛŒÚ©Û•ÛŒØ´Ù†Û•Ú©Ø§Ù† -->
    <div id="notificationContainer"></div>

    <!-- Ù…Û†Ø¯Ø§ÚµÛŒ Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•ÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ• -->
    <div id="customConfirmModal" class="confirm-modal">
        <div class="confirm-content">
            <h3>Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ!</h3>
            <p id="confirmMessage">Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ø¨Ø§Ø¨Û•ØªÛ•ØŸ</p>
            <div class="confirm-buttons" style="margin-top:20px;">
                <button class="confirm-yes" onclick="handleConfirm(true)">Ø¨Û•ÚµÛØŒ Ø¨ÛŒØ³Ú•Û•ÙˆÛ•</button>
                <button class="confirm-no" onclick="handleConfirm(false)">Ù†Û•Ø®ÛØ±ØŒ Ù¾Ø§Ø´Ú¯Û•Ø² Ø¨Û•ÙˆÛ•</button>
            </div>
        </div>
    </div>

    <div class="container" id="mainContent">
        <header>
            <h1>ğŸ« Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</h1>
            <p class="subtitle">Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ù¾ÛØ´Ú©Û•ÙˆØªÙˆÙˆÛŒ Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†</p>
            <p id="currentUserId" style="font-size: 0.8em; color: #94a3b8; margin-top: 5px;">Ù†Ø§Ø³Ù†Ø§Ù…Û•ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±: Ú†Ø§ÙˆÛ•Ú•ÛÛŒ Ø³ÛØ±Ø¨Û•Ø± Ø¯Û•Ú©Ø§Øª...</p>
        </header>

        <!-- Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù†ÛŒ Ú¯Û†Ú•ÛŒÙ†ÛŒ Ø¨Û•Ø´ (Ø¯ÙˆÚ¯Ù…Û•ÛŒ Ù†ÙˆÛ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§) -->
        <div class="nav-tabs">
            <button onclick="switchView('archive')" class="tab-btn active" id="btn-archive">ğŸ  Ù‡Û•Ù…ÙˆÙˆ Ø¦Û•Ø±Ø´ÛŒÙ</button>
            <button onclick="switchView('teachers')" class="tab-btn" id="btn-teachers">ğŸ‘¨â€ğŸ« Ù„ÛŒØ³ØªÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†</button>
            <button onclick="openTeacherActivityModal()" class="tab-btn" id="btn-record">ğŸ“ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</button>
        </div>

        <!-- Ø¨Û•Ø´ÛŒ Ú¯Û•Ú•Ø§Ù† Ùˆ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† -->
        <div class="controls" id="archiveControls">
            <input type="text" class="search-box" id="searchBox" placeholder="Ú¯Û•Ú•Ø§Ù† Ø¨Û•Ù¾ÛÛŒ Ù†Ø§ÙˆØŒ Ù…Ø§Ù…Û†Ø³ØªØ§ØŒ ÛŒØ§Ù† Ø¨Û•Ø±ÙˆØ§Ø±...">
            <!-- Ø¦Û•Ù… Ø¯ÙˆÚ¯Ù…Û•ÛŒÛ• Ù…Û†Ø¯Ø§ÚµÛŒ Ú©Û†Ù†ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ú¯Ø´ØªÛŒ Ø¯Û•Ú©Ø§ØªÛ•ÙˆÛ• -->
            <button class="add-btn" onclick="openGeneralAddModal()">
                <span>Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ú¯Ø´ØªÛŒ</span> <span>+</span>
            </button>
        </div>

        <!-- Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ù„Ø§ÙˆÛ•Ú©ÛŒ (ÙÙ„ØªÛ•Ø±) -->
        <div id="filterHeader" style="display:none; margin-bottom:25px; text-align:center;">
            <div style="display:inline-flex; align-items:center; background:white; padding:8px 20px; border-radius:50px; box-shadow: var(--shadow);">
                <span style="color:#64748b; margin-left:10px;">Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§:</span>
                <span id="filterTeacherName" style="font-weight:900; color:var(--primary); font-size:1.1em;"></span>
                <button onclick="clearFilter()" style="background:#fee2e2; color:#ef4444; border:none; width:30px; height:30px; border-radius:50%; margin-right:15px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:12px;">âœ•</button>
            </div>
        </div>

        <!-- Ø´ÙˆÛÙ†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù† -->
        <div class="activities-grid" id="activitiesGrid"></div>

        <!-- Ø´ÙˆÛÙ†ÛŒ Ù„ÛŒØ³ØªÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù† -->
        <div class="teachers-grid" id="teachersGrid"></div>
    </div>

    <!-- Ù…Û†Ø¯Ø§ÚµÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ú¯Ø´ØªÛŒ (Ú©Û†Ù†) -->
    <div class="modal" id="generalActivityModal">
        <div class="modal-content">
            <h2>Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ú¯Ø´ØªÛŒ Ù†ÙˆÛ</h2>
            <form id="generalActivityForm">
                <div class="form-group"><label>Ù†Ø§ÙˆÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ</label><input type="text" id="generalActivityName" required placeholder="Ù…Û•Ø³Û•Ù„Û•Ù†: Ø³ÛŒÙ…ÛŒÙ†Ø§Ø±ÛŒ Ø²Ø§Ù†Ø³ØªÛŒ..."></div>
                <div class="form-group"><label>Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</label><input type="text" id="generalTeacherName" required placeholder="Ù†Ø§ÙˆÛŒ Ø³ÛŒØ§Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§..."></div>
                <div class="form-group"><label>Ø¨Û•Ø±ÙˆØ§Ø±</label><input type="date" id="generalActivityDate" required></div>
                <div class="form-group">
                    <label>ÙˆÛÙ†Û•Ú©Ø§Ù† (Ù…Ø§Ú©Ø³ Ù¤)</label>
                    <div style="border: 2px dashed #cbd5e1; padding: 20px; text-align: center; border-radius: 12px; background: #f8fafc; cursor: pointer;" onclick="document.getElementById('generalImageInput').click()">
                        ğŸ“· ÙˆÛÙ†Û•Ú©Ø§Ù† Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•
                    </div>
                    <input type="file" id="generalImageInput" accept="image/*" multiple style="display:none">
                    <div id="generalUploadStatus" style="color: var(--primary); margin-top:10px; font-size:0.9em; font-weight:bold;"></div>
                </div>
                <div class="form-group"><label>ØªÛØ¨ÛŒÙ†ÛŒ</label><textarea id="generalActivityNotes" placeholder="ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Û•..." rows="3"></textarea></div>
                <button type="submit" class="save-btn" id="generalSaveBtn">ğŸ’¾ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†</button>
                <button type="button" onclick="closeGeneralAddModal()" style="width:100%; background:transparent; color:#64748b; border:none; padding:10px; margin-top:5px; cursor:pointer;">Ù¾Ø§Ø´Ú¯Û•Ø²Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•</button>
            </form>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§ÚµÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ (Ù†ÙˆÛ) -->
    <div class="modal" id="teacherActivityModal">
        <div class="modal-content">
            <h2>ğŸ“ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ ØªØ§ÛŒØ¨Û•ØªÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</h2>
            <form id="teacherActivityForm">
                <div class="form-group"><label>Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</label><input type="text" id="teacherRecordName" required placeholder="Ù†Ø§ÙˆÛŒ Ø³ÛŒØ§Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§..."></div>
                <div class="form-group"><label>Ù†Ø§ÙˆÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ/Ø¬Û†Ø±</label><input type="text" id="teacherRecordActivityType" required placeholder="Ù…Û•Ø³Û•Ù„Û•Ù†: ØªØ§Ù‚ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø®ÛØ±Ø§ØŒ Ù¾Ú•Û†Ú˜Û•ÛŒ Ø¯Û•Ø³ØªÛŒ..."></div>
                
                <div class="form-group">
                    <label>Ù†Ø§ÙˆÛŒ Ø¯Û•Ø±Ø³</label>
                    <select id="teacherRecordCourse" required>
                        <option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
                        <option value="Ú©ÙˆØ±Ø¯ÛŒ">Ú©ÙˆØ±Ø¯ÛŒ</option>
                        <option value="Ø¨ÛŒØ±Ú©Ø§Ø±ÛŒ">Ø¨ÛŒØ±Ú©Ø§Ø±ÛŒ</option>
                        <option value="Ø²Ø§Ù†Ø³Øª">Ø²Ø§Ù†Ø³Øª</option>
                        <option value="Ú©Û†Ù…Û•ÚµØ§ÛŒÛ•ØªÛŒ">Ú©Û†Ù…Û•ÚµØ§ÛŒÛ•ØªÛŒ</option>
                        <option value="Ù¾Û•Ø±ÙˆÛ•Ø±Ø¯Û•ÛŒ Ø¦ÛŒØ³Ù„Ø§Ù…ÛŒ">Ù¾Û•Ø±ÙˆÛ•Ø±Ø¯Û•ÛŒ Ø¦ÛŒØ³Ù„Ø§Ù…ÛŒ</option>
                        <option value="Ù‡ÙˆÙ†Û•Ø±">Ù‡ÙˆÙ†Û•Ø±</option>
                        <option value="ÙˆÛ•Ø±Ø²Ø´">ÙˆÛ•Ø±Ø²Ø´</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Ø±Û†Ú˜ÛŒ Ù‡Û•ÙØªÛ•</label>
                    <select id="teacherRecordDay" required>
                        <option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
                        <option value="Ø´Û•Ù…Û•">Ø´Û•Ù…Û•</option>
                        <option value="ÛŒÛ•Ú©Ø´Û•Ù…Û•">ÛŒÛ•Ú©Ø´Û•Ù…Û•</option>
                        <option value="Ø¯ÙˆÙˆØ´Û•Ù…Û•">Ø¯ÙˆÙˆØ´Û•Ù…Û•</option>
                        <option value="Ø³ÛØ´Û•Ù…Û•">Ø³ÛØ´Û•Ù…Û•</option>
                        <option value="Ú†ÙˆØ§Ø±Ø´Û•Ù…Û•">Ú†ÙˆØ§Ø±Ø´Û•Ù…Û•</option>
                        <option value="Ù¾ÛÙ†Ø¬Ø´Û•Ù…Û•">Ù¾ÛÙ†Ø¬Ø´Û•Ù…Û•</option>
                        <option value="Ø¬ÙˆÙ…Ø¹Û•">Ø¬ÙˆÙ…Ø¹Û•</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ø¯Û•Ø±Ø³ (Ú©Ø§ØªÚ˜Ù…ÛØ±)</label>
                    <select id="teacherRecordLesson" required>
                        <option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
                        <option value="Ø¯Û•Ø³ÛŒ ÛŒÛ•Ú©Û•Ù…">Ø¯Û•Ø³ÛŒ ÛŒÛ•Ú©Û•Ù…</option>
                        <option value="Ø¯Û•Ø³ÛŒ Ø¯ÙˆÙˆÛ•Ù…">Ø¯Û•Ø³ÛŒ Ø¯ÙˆÙˆÛ•Ù…</option>
                        <option value="Ø¯Û•Ø³ÛŒ Ø³ÛÛŒÛ•Ù…">Ø¯Û•Ø³ÛŒ Ø³ÛÛŒÛ•Ù…</option>
                        <option value="Ø¯Û•Ø³ÛŒ Ú†ÙˆØ§Ø±Û•Ù…">Ø¯Û•Ø³ÛŒ Ú†ÙˆØ§Ø±Û•Ù…</option>
                        <option value="Ø¯Û•Ø³ÛŒ Ù¾ÛÙ†Ø¬Û•Ù…">Ø¯Û•Ø³ÛŒ Ù¾ÛÙ†Ø¬Û•Ù…</option>
                        <option value="Ø¯Û•Ø³ÛŒ Ø´Û•Ø´Û•Ù…">Ø¯Û•Ø³ÛŒ Ø´Û•Ø´Û•Ù…</option>
                    </select>
                </div>

                <div class="form-group"><label>Ø¨Û•Ø±ÙˆØ§Ø±</label><input type="date" id="teacherRecordDate" required></div>
                <div class="form-group">
                    <label>ÙˆÛÙ†Û•Ú©Ø§Ù† (Ù…Ø§Ú©Ø³ Ù¤)</label>
                    <div style="border: 2px dashed #cbd5e1; padding: 20px; text-align: center; border-radius: 12px; background: #f8fafc; cursor: pointer;" onclick="document.getElementById('teacherRecordImageInput').click()">
                        ğŸ“· ÙˆÛÙ†Û•Ú©Ø§Ù† Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•
                    </div>
                    <input type="file" id="teacherRecordImageInput" accept="image/*" multiple style="display:none">
                    <div id="teacherRecordUploadStatus" style="color: var(--primary); margin-top:10px; font-size:0.9em; font-weight:bold;"></div>
                </div>
                <div class="form-group"><label>ØªÛØ¨ÛŒÙ†ÛŒ</label><textarea id="teacherRecordNotes" placeholder="ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Û•..." rows="3"></textarea></div>
                <button type="submit" class="save-btn" id="teacherRecordSaveBtn">ğŸ’¾ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</button>
                <button type="button" onclick="closeTeacherActivityModal()" style="width:100%; background:transparent; color:#64748b; border:none; padding:10px; margin-top:5px; cursor:pointer;">Ù¾Ø§Ø´Ú¯Û•Ø²Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•</button>
            </form>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§ÚµÛŒ Ú¯Û•ÙˆØ±Û•Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û• (Ù‡Û•Ù…Ø§Ù† Ø¯ÛŒØ²Ø§ÛŒÙ†ÛŒ Ù¾ÛØ´ÙˆÙˆ) -->
    <div class="image-modal" id="imageModal" onclick="this.classList.remove('active')"><img id="modalImage" src=""></div>

    <!-- Firebase & Custom JS Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, where, getDocs, orderBy, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // setLogLevel('Debug');

        // Global Firebase Variables (Mandatory for Canvas Environment)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { /* Fallback */ };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-gzng-app-id';

        let app, db, auth, storage, activitiesRef;
        let authReady = false;
        let currentUserId = null;

        // --- Custom Notification & Confirm Logic ---
        function showToast(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = (type === 'success' ? 'âœ… ' : 'âŒ ') + message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 10); // Tiny delay to trigger CSS transition

            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 5000);
        }

        let confirmCallback = null;
        window.customConfirm = (message) => {
            return new Promise((resolve) => {
                document.getElementById('confirmMessage').textContent = message;
                document.getElementById('customConfirmModal').style.display = 'flex';
                confirmCallback = resolve;
            });
        };

        window.handleConfirm = (result) => {
            document.getElementById('customConfirmModal').style.display = 'none';
            if (confirmCallback) {
                confirmCallback(result);
                confirmCallback = null;
            }
        };
        // End of Custom Notification & Confirm Logic

        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    throw new Error("Ù¾ÛÚ©Ù‡Ø§ØªÛ•ÛŒ ÙØ§ÛŒÛ•Ø±Ø¨Û•ÛŒØ³ Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•.");
                }

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                storage = getStorage(app);

                // Firestore Collection Path - Public Data is assumed for a school archive
                activitiesRef = collection(db, 'artifacts', appId, 'public', 'data', 'activities');
                
                // Authentication
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        document.getElementById('currentUserId').textContent = `Ù†Ø§Ø³Ù†Ø§Ù…Û•ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±: ${currentUserId}`;
                        authReady = true;
                        startListeningForActivities();
                    } else {
                        currentUserId = null;
                        document.getElementById('currentUserId').textContent = `Ù†Ø§Ø³Ù†Ø§Ù…Û•ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±: Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ù†Û•Ú©Ø±Ø§ÙˆÛ•`;
                    }
                });

            } catch (error) {
                console.error("Ù‡Û•ÚµÛ•ÛŒ Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨Û• ÙØ§ÛŒÛ•Ø±Ø¨Û•ÛŒØ³Û•ÙˆÛ•:", error);
                showToast("Ù‡Û•ÚµÛ• Ù„Û• Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨Û• Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³: " + error.message, 'error');
                document.getElementById('globalLoader').style.display = 'none';
            }
        }

        let allActivities = [];
        let currentFilter = null;

        function startListeningForActivities() {
            if (!authReady || !db) return;

            const q = query(activitiesRef, orderBy("date", "desc"));
            onSnapshot(q, (snapshot) => {
                allActivities = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                renderApp();
                document.getElementById('globalLoader').style.display = 'none';
            }, (error) => {
                console.error("Ù‡Û•ÚµÛ•ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ø¯Ø§ØªØ§ Ù„Û• ÙØ§ÛŒÛ•Ø±Ø¨Û•ÛŒØ³:", error);
                showToast("Ù‡Û•ÚµÛ• Ù„Û• ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†.", 'error');
            });
        }

        function renderApp() {
            const grid = document.getElementById('activitiesGrid');
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            
            let displayList = allActivities;

            if (currentFilter) {
                displayList = displayList.filter(a => a.teacher && a.teacher.toLowerCase() === currentFilter.toLowerCase());
                document.getElementById('filterHeader').style.display = 'block';
                document.getElementById('filterTeacherName').textContent = currentFilter;
            } else {
                document.getElementById('filterHeader').style.display = 'none';
            }

            displayList = displayList.filter(a => 
                (a.name && a.name.toLowerCase().includes(searchTerm)) || 
                (a.teacher && a.teacher.toLowerCase().includes(searchTerm)) ||
                (a.date && a.date.includes(searchTerm)) ||
                (a.course && a.course.toLowerCase().includes(searchTerm))
            );

            grid.innerHTML = displayList.map(act => `
                <div class="activity-card">
                    <div class="activity-header">
                        <h3>${act.name}</h3>
                        <div class="activity-meta">
                            <span>ğŸ‘¤ ${act.teacher || 'Ù†Û•Ø²Ø§Ù†Ø±Ø§Ùˆ'}</span>
                            <span>ğŸ“… ${act.date}</span>
                        </div>
                        ${act.course ? `<div style="font-size:0.9em; color:${act.day ? '#10b981' : '#4f46e5'}; font-weight:700; margin-top:5px;">${act.course} ${act.day ? ` - ${act.day}, ${act.lesson || ''}` : ''}</div>` : ''}
                    </div>
                    <div class="images-container">
                        ${act.images ? act.images.map(url => `<img src="${url}" class="activity-image" onclick="openImg('${url}')" onerror="this.onerror=null;this.src='https://placehold.co/500x300/e0e7ff/4f46e5?text=ÙˆÛÙ†Û•+Ù†ÛŒÛŒÛ•';">`).join('') : ''}
                    </div>
                    ${act.notes ? `<div class="activity-notes">${act.notes}</div>` : ''}
                    <div class="card-footer">
                        <button class="delete-btn" onclick="deleteItem('${act.id}')">ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
                    </div>
                </div>
            `).join('');
            
            if(displayList.length === 0) grid.innerHTML = '<p style="color:var(--text-gray); grid-column:1/-1; text-align:center; font-weight:bold; font-size:1.2em; margin-top:20px;">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•.</p>';

            renderTeachersList();
        }

        function renderTeachersList() {
            const teachersGrid = document.getElementById('teachersGrid');
            const teachersMap = {};
            allActivities.forEach(act => {
                const tName = act.teacher ? act.teacher.trim() : 'Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒ Ù†Û•Ù†Ø§Ø³Ø±Ø§Ùˆ';
                if (!teachersMap[tName]) teachersMap[tName] = 0;
                teachersMap[tName]++;
            });

            const sortedTeachers = Object.keys(teachersMap).sort((a, b) => teachersMap[b] - teachersMap[a]);

            teachersGrid.innerHTML = sortedTeachers.map(tName => `
                <div class="teacher-card" onclick="filterByTeacher('${tName}')">
                    <div class="teacher-avatar">ğŸ‘¤</div>
                    <div class="teacher-name">${tName}</div>
                    <div class="stat-badge">ğŸ“Š ${teachersMap[tName]} Ú†Ø§Ù„Ø§Ú©ÛŒ</div>
                </div>
            `).join('');
        }

        window.switchView = (view) => {
            // Hide all content containers first
            document.getElementById('activitiesGrid').style.display = 'none';
            document.getElementById('archiveControls').style.display = 'none';
            document.getElementById('filterHeader').style.display = 'none';
            document.getElementById('teachersGrid').style.display = 'none';
            
            // Remove active class from all buttons
            document.getElementById('btn-archive').classList.remove('active');
            document.getElementById('btn-teachers').classList.remove('active');
            document.getElementById('btn-record').classList.remove('active');

            if (view === 'archive') {
                document.getElementById('activitiesGrid').style.display = 'grid';
                document.getElementById('archiveControls').style.display = 'flex';
                document.getElementById('btn-archive').classList.add('active');
                currentFilter = null;
                renderApp();
            } else if (view === 'teachers') {
                document.getElementById('teachersGrid').style.display = 'grid';
                document.getElementById('btn-teachers').classList.add('active');
            } else if (view === 'record') {
                // The 'record' button will open a modal, so we don't need a dedicated view container
                // but we should make sure the archive view is primary
                switchView('archive'); // Fallback to archive view
                openTeacherActivityModal(); // Open the modal
            }
        };

        window.filterByTeacher = (tName) => {
            currentFilter = tName;
            window.switchView('archive');
        };

        window.clearFilter = () => {
            currentFilter = null;
            renderApp();
        };

        window.renderApp = renderApp;
        document.getElementById('searchBox').addEventListener('input', renderApp);

        // --- IMAGE HANDLING ---
        function compressImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 1024;
                        const scaleSize = MAX_WIDTH / img.width;
                        
                        if (img.width > MAX_WIDTH) {
                            canvas.width = MAX_WIDTH;
                            canvas.height = img.height * scaleSize;
                        } else {
                            canvas.width = img.width;
                            canvas.height = img.height;
                        }
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        
                        canvas.toBlob((blob) => {
                            resolve(blob);
                        }, 'image/jpeg', 0.7);
                    };
                    img.onerror = (err) => reject(err);
                };
                reader.onerror = (err) => reject(err);
            });
        }

        async function uploadImage(file, statusDiv) {
            statusDiv.textContent = `Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û• (Ø¯Û•Ù¾Û•Ø³ØªÛÙˆØ±ÛØªÛ•ÙˆÛ•)...`;
            try {
                const compressedBlob = await compressImage(file);
                const storagePath = `images/${currentUserId}/${Date.now()}-${file.name}`;
                const storageRef = ref(storage, storagePath);
                await uploadBytes(storageRef, compressedBlob);
                return await getDownloadURL(storageRef);
            } catch (error) {
                console.error("Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•:", error);
                throw new Error("Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•.");
            }
        }

        // --- MODAL & FORM LOGIC ---

        // General Activity Modal (Original functionality)
        window.openGeneralAddModal = () => document.getElementById('generalActivityModal').classList.add('active');
        window.closeGeneralAddModal = () => { 
            document.getElementById('generalActivityModal').classList.remove('active'); 
            document.getElementById('generalActivityForm').reset();
            document.getElementById('generalUploadStatus').textContent = '';
        };

        // Teacher Activity Modal (New functionality)
        window.openTeacherActivityModal = () => {
            document.getElementById('teacherActivityModal').classList.add('active');
        }
        window.closeTeacherActivityModal = () => {
            document.getElementById('teacherActivityModal').classList.remove('active');
            document.getElementById('teacherActivityForm').reset();
            document.getElementById('teacherRecordUploadStatus').textContent = '';
        }

        window.openImg = (url) => { 
            document.getElementById('modalImage').src = url; 
            document.getElementById('imageModal').classList.add('active'); 
        };

        window.deleteItem = async (id) => {
            const confirmed = await customConfirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•ØŸ Ø¦Û•Ù… Ú©Ø±Ø¯Ø§Ø±Û• Ù†Ø§ØªÙˆØ§Ù†Ø±ÛØª Ù‡Û•ÚµØ¨ÙˆÛ•Ø´ÛÙ†Ø±ÛØªÛ•ÙˆÛ•.");
            
            if (confirmed) {
                try {
                    await deleteDoc(doc(db, "artifacts", appId, "public", "data", "activities", id));
                    showToast("âœ… Ú†Ø§Ù„Ø§Ú©ÛŒ Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•.");
                } catch (error) {
                    showToast("âŒ Ù‡Û•ÚµÛ• Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ: " + error.message, 'error');
                }
            }
        };


        // --- SUBMIT HANDLERS ---

        // 1. General Activity Submit Handler
        document.getElementById('generalActivityForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const saveBtn = document.getElementById('generalSaveBtn');
            const statusDiv = document.getElementById('generalUploadStatus');
            saveBtn.disabled = true;
            saveBtn.textContent = 'â³ Ú†Ø§ÙˆÛ•Ú•ÛØ¨Û•...';
            
            try {
                const imageFiles = document.getElementById('generalImageInput').files;
                if(imageFiles.length > 4) throw new Error("ØªÛ•Ù†Ù‡Ø§ Ù¤ ÙˆÛÙ†Û• Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø±Ø§ÙˆÛ•");

                let imageUrls = [];
                for(let i=0; i<imageFiles.length; i++) {
                    statusDiv.textContent = `Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•ÛŒ ${i+1} Ù„Û• ${imageFiles.length} (Ø¯Û•Ù¾Û•Ø³ØªÛÙˆØ±ÛØªÛ•ÙˆÛ•)...`;
                    const url = await uploadImage(imageFiles[i], statusDiv);
                    imageUrls.push(url);
                }
                
                await addDoc(activitiesRef, {
                    name: document.getElementById('generalActivityName').value,
                    teacher: document.getElementById('generalTeacherName').value.trim(),
                    date: document.getElementById('generalActivityDate').value,
                    notes: document.getElementById('generalActivityNotes').value,
                    images: imageUrls,
                    isTeacherRecord: false,
                    createdAt: new Date()
                });

                closeGeneralAddModal();
                showToast("âœ… Ú†Ø§Ù„Ø§Ú©ÛŒ Ú¯Ø´ØªÛŒ Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§!");
            } catch (error) {
                showToast("âŒ Ù‡Û•ÚµÛ• Ù„Û• ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†: " + error.message, 'error');
                console.error(error);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'ğŸ’¾ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†';
                statusDiv.textContent = '';
            }
        });

        // 2. Teacher Activity Submit Handler (NEW)
        document.getElementById('teacherActivityForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const saveBtn = document.getElementById('teacherRecordSaveBtn');
            const statusDiv = document.getElementById('teacherRecordUploadStatus');
            saveBtn.disabled = true;
            saveBtn.textContent = 'â³ Ú†Ø§ÙˆÛ•Ú•ÛØ¨Û•...';
            
            try {
                const imageFiles = document.getElementById('teacherRecordImageInput').files;
                if(imageFiles.length > 4) throw new Error("ØªÛ•Ù†Ù‡Ø§ Ù¤ ÙˆÛÙ†Û• Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø±Ø§ÙˆÛ•");

                let imageUrls = [];
                for(let i=0; i<imageFiles.length; i++) {
                    statusDiv.textContent = `Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•ÛŒ ${i+1} Ù„Û• ${imageFiles.length} (Ø¯Û•Ù¾Û•Ø³ØªÛÙˆØ±ÛØªÛ•ÙˆÛ•)...`;
                    const url = await uploadImage(imageFiles[i], statusDiv);
                    imageUrls.push(url);
                }
                
                await addDoc(activitiesRef, {
                    name: document.getElementById('teacherRecordActivityType').value,
                    teacher: document.getElementById('teacherRecordName').value.trim(),
                    date: document.getElementById('teacherRecordDate').value,
                    notes: document.getElementById('teacherRecordNotes').value,
                    course: document.getElementById('teacherRecordCourse').value,
                    day: document.getElementById('teacherRecordDay').value,
                    lesson: document.getElementById('teacherRecordLesson').value,
                    images: imageUrls,
                    isTeacherRecord: true,
                    createdAt: new Date()
                });

                closeTeacherActivityModal();
                showToast("âœ… Ú†Ø§Ù„Ø§Ú©ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§!");
            } catch (error) {
                showToast("âŒ Ù‡Û•ÚµÛ• Ù„Û• ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†: " + error.message, 'error');
                console.error(error);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'ğŸ’¾ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†';
                statusDiv.textContent = '';
            }
        });

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', initializeFirebase);
        
    </script>

    <script>
        // Old password check function remains to unlock the app UI
        function checkPassword() {
            var input = document.getElementById('sitePassword').value;
            if(input === "2526") { 
                document.getElementById('securityOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }
        document.getElementById('sitePassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') checkPassword();
        });
    </script>
</body>
</html>
