<!DOCTYPE html>
<html lang="ku" dir="rtl" data-theme="light">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Gzng Archive System</title>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Rudaw:wght@400;700;900&family=Noto+Sans+Arabic:wght@300;400;700;800&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-body: #f0f2f5; --bg-glass: rgba(255, 255, 255, 0.95); --bg-nav: rgba(255, 255, 255, 0.9);
Â  Â  Â  Â  Â  Â  --bg-card: #ffffff; --text-main: #1e293b; --text-light: #64748b;
Â  Â  Â  Â  Â  Â  --primary: #6366f1; --primary-gradient: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
Â  Â  Â  Â  Â  Â  --shadow: 0 4px 20px rgba(0, 0, 0, 0.08); --border: 1px solid rgba(0, 0, 0, 0.05); --radius: 16px;
Â  Â  Â  Â  Â  Â  --font-main: 'Noto Sans Arabic', 'Rudaw', sans-serif;
Â  Â  Â  Â  }
Â  Â  Â  Â  [data-theme="dark"] {
Â  Â  Â  Â  Â  Â  --bg-body: #0f172a; --bg-glass: rgba(30, 41, 59, 0.9); --bg-nav: rgba(15, 23, 42, 0.9);
Â  Â  Â  Â  Â  Â  --bg-card: #1e293b; --text-main: #f1f5f9; --text-light: #94a3b8;
Â  Â  Â  Â  Â  Â  --primary: #818cf8; --primary-gradient: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);
Â  Â  Â  Â  Â  Â  --shadow: 0 4px 20px rgba(0, 0, 0, 0.3); --border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  html[lang="en"] { --font-main: 'Roboto', sans-serif; }

Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
Â  Â  Â  Â  body { font-family: var(--font-main); background-color: var(--bg-body); min-height: 100vh; color: var(--text-main); overflow-x: hidden; padding-top: 80px; padding-bottom: 40px; transition: background-color 0.3s ease; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .glass { background: var(--bg-glass); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
Â  Â  Â  Â  button { cursor: pointer; font-family: inherit; border: none; background: none; }

Â  Â  Â  Â  .navbar { position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; background: var(--bg-nav); backdrop-filter: blur(15px); border-bottom: var(--border); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .nav-brand { font-size: 1.3em; font-weight: 900; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â  .nav-logo-icon { width: 35px; height: 35px; background: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; }
Â  Â  Â  Â  .nav-right { display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .icon-btn { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2em; transition: 0.3s; color: var(--text-main); font-weight: bold; border: 1px solid transparent; }
Â  Â  Â  Â  .icon-btn:hover { background: rgba(128,128,128,0.1); border-color: var(--border); }

Â  Â  Â  Â  .lang-dropdown { position: relative; }
Â  Â  Â  Â  .lang-menu {
Â  Â  Â  Â  Â  Â  position: absolute; top: 120%; left: -10px; background: var(--bg-card); border: var(--border); border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow); width: 160px; display: none; flex-direction: column; overflow: hidden; z-index: 2000;
Â  Â  Â  Â  }
Â  Â  Â  Â  html[dir="ltr"] .lang-menu { right: -10px; left: auto; }
Â  Â  Â  Â  .lang-menu.show { display: flex; animation: fadeIn 0.2s ease; }
Â  Â  Â  Â  .lang-item { padding: 12px 15px; text-align: start; cursor: pointer; transition: 0.2s; font-size: 0.95em; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â  .lang-item:hover { background: rgba(128,128,128,0.1); color: var(--primary); }

Â  Â  Â  Â  .admin-link-btn { background: rgba(128,128,128,0.1); color: var(--text-main); padding: 8px 15px; border-radius: 50px; font-weight: bold; font-size: 0.9em; display: flex; align-items: center; gap: 6px; transition: 0.3s; }
Â  Â  Â  Â  .admin-link-btn:hover { background: var(--primary); color: white; }

Â  Â  Â  Â  .container { max-width: 1200px; margin: 0 auto; width: 95%; animation: fadeIn 0.5s ease; }
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

Â  Â  Â  Â  .nav-pills { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; margin-top: 10px; flex-wrap: wrap; }
Â  Â  Â  Â  .pill { padding: 10px 25px; border-radius: 50px; font-weight: bold; color: var(--text-light); background: var(--bg-card); border: var(--border); transition: 0.3s; display: flex; align-items: center; gap: 5px;}
Â  Â  Â  Â  .pill.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transform: scale(1.05); border-color: transparent; }

Â  Â  Â  Â  .search-area { max-width: 600px; margin: 0 auto 20px; position: relative; }
Â  Â  Â  Â  .search-input { width: 100%; padding: 15px 20px; border-radius: 50px; border: var(--border); background: var(--bg-card); color: var(--text-main); font-size: 1em; box-shadow: var(--shadow); transition: 0.3s; font-family: var(--font-main); }
Â  Â  Â  Â  .search-input:focus { transform: scale(1.01); border-color: var(--primary); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .add-activity-btn { display: flex; align-items: center; justify-content: center; gap: 10px; background: var(--primary-gradient); color: white; padding: 12px 25px; border-radius: 50px; font-weight: bold; margin: 0 auto 30px; box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3); transition: 0.3s; width: fit-content; }
Â  Â  Â  Â  .add-activity-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4); }

Â  Â  Â  Â  .filter-header { display: none; align-items: center; justify-content: space-between; padding: 15px; margin-bottom: 25px; background: var(--bg-card); border-radius: 15px; border: var(--border); }

Â  Â  Â  Â  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
Â  Â  Â  Â  .card { background: var(--bg-card); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow); border: var(--border); display: flex; flex-direction: column; transition: 0.3s; }
Â  Â  Â  Â  .card:hover { transform: translateY(-5px); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-img-grid { display: grid; grid-template-columns: 1fr 1fr; height: 180px; width: 100%; gap: 1px; background: #e2e8f0; flex-shrink: 0; }
Â  Â  Â  Â  .card-img-grid img { width: 100%; height: 100%; object-fit: cover; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-body { padding: 15px; flex-grow: 1; background: var(--bg-card); position: relative; z-index: 2; }
Â  Â  Â  Â  .card-title { font-weight: 800; font-size: 1.1em; margin-bottom: 8px; color: var(--text-main); }
Â  Â  Â  Â  .card-info { font-size: 0.85em; color: var(--text-light); display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
Â  Â  Â  Â  .card-footer { padding: 12px 15px; background: rgba(128,128,128,0.03); border-top: 1px solid rgba(128,128,128,0.05); }
Â  Â  Â  Â  .btn-card { width: 100%; padding: 10px; border-radius: 10px; background: rgba(99, 102, 241, 0.1); color: var(--primary); font-weight: bold; transition: 0.2s; }
Â  Â  Â  Â  .btn-card:hover { background: var(--primary); color: white; }

Â  Â  Â  Â  .teacher-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
Â  Â  Â  Â  .teacher-item { text-align: center; padding: 20px 10px; background: var(--bg-card); border-radius: 20px; transition: 0.3s; border: var(--border); cursor: pointer; box-shadow: var(--shadow); }
Â  Â  Â  Â  .teacher-item:hover { transform: translateY(-5px); border-color: var(--primary); }
Â  Â  Â  Â  .avatar-lg { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; object-fit: contain; border: 3px solid var(--primary); padding: 10px; background: var(--bg-body); }

Â  Â  Â  Â  .admin-dashboard { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 2000; overflow-y: auto; display: none; }
Â  Â  Â  Â  .admin-nav { position: sticky; top: 0; background: #1e293b; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

Â  Â  Â  Â  .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 3000; display: none; justify-content: center; align-items: center; padding: 20px; opacity: 0; transition: opacity 0.2s; }
Â  Â  Â  Â  .modal-overlay.active { display: flex; opacity: 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .editor-container { width: 100%; max-width: 900px; display: flex; flex-direction: column; gap: 15px; height: 90vh; }
Â  Â  Â  Â  .editor-toolbar { background: #1e293b; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; color: white; }
Â  Â  Â  Â  .paper-area { background: #334155; padding: 20px; border-radius: 15px; flex-grow: 1; overflow: auto; display: flex; justify-content: center; }
Â  Â  Â  Â  .a4-page { width: 210mm; min-height: 297mm; background: white; padding: 15mm; color: black; direction: rtl; text-align: right; display: flex; flex-direction: column; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  html[dir="ltr"] .a4-page { text-align: left; direction: ltr; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .p-header { display: flex; justify-content: space-between; border-bottom: 3px solid black; padding-bottom: 15px; margin-bottom: 20px; }
Â  Â  Â  Â  .p-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #f8fafc; padding: 15px; border: 1px solid #e2e8f0; margin-bottom: 20px; }
Â  Â  Â  Â  .p-input { width: 100%; border: none; border-bottom: 1px dashed #cbd5e1; background: transparent; font-weight: bold; padding: 2px; font-family: inherit; }
Â  Â  Â  Â  .p-images { display: grid; gap: 10px; margin-top: 20px; }
Â  Â  Â  Â  .p-images.landscape { grid-template-columns: 1fr 1fr; } .p-images.landscape .slot { height: 180px; }
Â  Â  Â  Â  .p-images.portrait { grid-template-columns: 1fr 1fr; } .p-images.portrait .slot { height: 280px; }
Â  Â  Â  Â  .slot { background: #f1f5f9; border: 2px dashed #cbd5e1; border-radius: 8px; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }
Â  Â  Â  Â  .slot img { width: 100%; height: 100%; object-fit: contain; }
Â  Â  Â  Â  .controls { position: absolute; bottom: 5px; display: flex; gap: 5px; background: rgba(0,0,0,0.6); padding: 5px; border-radius: 20px; opacity: 0; transition: 0.2s; }
Â  Â  Â  Â  .slot:hover .controls { opacity: 1; }
Â  Â  Â  Â  .c-btn { width: 25px; height: 25px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }

Â  Â  Â  Â  @media print {
Â  Â  Â  Â  Â  Â  body * { visibility: hidden; } .a4-page, .a4-page * { visibility: visible; }
Â  Â  Â  Â  Â  Â  .a4-page { position: absolute; left: 0; top: 0; margin: 0; padding: 10mm; width: 210mm; height: 297mm; }
Â  Â  Â  Â  Â  Â  .controls, .editor-toolbar, .modal-overlay { display: none !important; }
Â  Â  Â  Â  }
Â  Â  Â  Â  @media (max-width: 768px) { .nav-brand span { font-size: 0.9em; } .a4-page { width: 100%; height: auto; aspect-ratio: 210/297; padding: 5mm; } .p-images.landscape .slot { height: 120px; } }
Â  Â  </style>
</head>
<body>

Â  Â  <nav class="navbar">
Â  Â  Â  Â  <div class="nav-brand"><div class="nav-logo-icon">ğŸ«</div><span data-i18n="app_title">Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú¯Ø²Ù†Ú¯</span></div>
Â  Â  Â  Â  <div class="nav-right">
Â  Â  Â  Â  Â  Â  <div class="lang-dropdown">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="toggleLangMenu()" class="icon-btn">ğŸŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="langMenu" class="lang-menu">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="lang-item" onclick="setLang('ku')"><span>ğŸ³ï¸</span> Ú©ÙˆØ±Ø¯ÛŒ</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="lang-item" onclick="setLang('en')"><span>ğŸ‡ºğŸ‡¸</span> English</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="lang-item" onclick="setLang('ar')"><span>ğŸ‡®ğŸ‡¶</span> Ø¹Ø±Ø¨ÙŠ</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button onclick="toggleTheme()" class="icon-btn" id="themeIcon">ğŸŒ™</button>
Â  Â  Â  Â  Â  Â  <button id="adminBtn" class="admin-link-btn"><span>ğŸ”‘</span> <span data-i18n="btn_admin" style="font-size:0.9em;">Ø¦Û•Ø¯Ù…ÛŒÙ†</span></button>
Â  Â  Â  Â  </div>
Â  Â  </nav>

Â  Â  <div id="securityOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; z-index:9999; display:flex; justify-content:center; align-items:center;">
Â  Â  Â  Â  <div class="glass" style="padding:40px; text-align:center; max-width:300px; width:90%; background:white;">
Â  Â  Â  Â  Â  Â  <div style="font-size:3em; margin-bottom:10px;">ğŸ”’</div><h2 style="margin-bottom:20px; color:#333;" data-i18n="secure_area">Ù¾Ø§Ø±ÛØ²Ø±Ø§Ùˆ</h2>
Â  Â  Â  Â  Â  Â  <input type="password" id="sitePassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:10px; margin-bottom:15px; text-align:center;">
Â  Â  Â  Â  Â  Â  <button onclick="checkSitePassword()" class="admin-link-btn" style="width:100%; justify-content:center; background:var(--primary); color:white;" data-i18n="btn_login">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  <p id="errorMsg" style="color:red; margin-top:10px; display:none;" data-i18n="error_pass">Ù‡Û•ÚµÛ•ÛŒÛ•</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="adminAuthModal" class="modal-overlay" style="z-index:9000;">
Â  Â  Â  Â  <div class="glass" style="background:white; padding:30px; width:90%; max-width:350px; text-align:center;">
Â  Â  Â  Â  Â  Â  <h3 data-i18n="admin_login_title">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±</h3>
Â  Â  Â  Â  Â  Â  <input type="email" id="adminEmail" placeholder="Email" class="search-input" style="margin:15px 0 10px; border:1px solid #ddd;">
Â  Â  Â  Â  Â  Â  <input type="password" id="adminPass" placeholder="Password" class="search-input" style="margin-bottom:20px; border:1px solid #ddd;">
Â  Â  Â  Â  Â  Â  <button onclick="loginAdmin()" class="admin-link-btn" style="width:100%; justify-content:center; background:var(--primary); color:white;" data-i18n="btn_login">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('adminAuthModal').classList.remove('active')" style="margin-top:15px; color:#666;" data-i18n="btn_close">Ø¯Ø§Ø®Ø³ØªÙ†</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="mainContent" style="display:none;">
Â  Â  Â  Â  <div class="container">
Â  Â  Â  Â  Â  Â  <div class="nav-pills">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchView('archive')" class="pill active" id="btn-archive" data-i18n="tab_archive">Ø¦Û•Ø±Ø´ÛŒÙ</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchView('teachers')" class="pill" id="btn-teachers" data-i18n="tab_teachers">Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.open('https://gzng-school.vercel.app/', '_blank')" class="pill" style="background: #ecfdf5; color: #059669; border-color: #10b981;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“… <span data-i18n="btn_schedule">Ø®Ø´ØªÛ•ÛŒ Ú•Û†Ú˜Ø§Ù†Û•</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="archiveControls">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="search-area"><input type="text" class="search-input" id="searchBox" onkeyup="filterActivities()" placeholder="Ú¯Û•Ú•Ø§Ù†..."></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center;"><button onclick="openEditor()" class="add-activity-btn" id="btnAddActivity"><span style="margin:0 5px;">â•</span> <span data-i18n="btn_add_activity">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛ</span></button></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="filterHeader" class="filter-header">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:15px;"><div id="filterAvatarContainer"></div><h2 id="filterName" style="font-size:1.2em; margin:0;"></h2></div>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="clearFilter()" style="color:#ef4444; background:rgba(239, 68, 68, 0.1); padding:8px 15px; border-radius:10px;" data-i18n="btn_back">âŒ Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="activitiesGrid" class="grid"></div>
Â  Â  Â  Â  Â  Â  <div id="teachersGrid" class="teacher-grid" style="display:none;"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="adminDashboard" class="admin-dashboard">
Â  Â  Â  Â  <div class="admin-nav">
Â  Â  Â  Â  Â  Â  <h2 style="display:flex; align-items:center; gap:10px;">âš™ï¸ <span data-i18n="dashboard">Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯</span> <span style="font-size:0.6em; background:#334155; padding:2px 8px; border-radius:10px;" data-i18n="btn_admin">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±</span></h2>
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;"><button onclick="closeAdminDashboard()" style="background:#3b82f6; color:white; padding:8px 15px; border-radius:8px;" data-i18n="btn_back_site">ğŸ”™ Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button><button onclick="logoutAdmin()" style="background:#ef4444; color:white; padding:8px 15px; border-radius:8px;" data-i18n="btn_logout">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="container" style="padding-top:30px;">
Â  Â  Â  Â  Â  Â  <div class="grid" style="margin-bottom:30px;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card" style="padding:20px; text-align:center;"><div style="font-size:2.5em; font-weight:900; color:var(--primary);" id="statActivities">0</div><p data-i18n="stat_activity">Ú†Ø§Ù„Ø§Ú©ÛŒ</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card" style="padding:20px; text-align:center;"><div style="font-size:2.5em; font-weight:900; color:var(--primary);" id="statTeachers">0</div><p data-i18n="stat_teacher">Ù…Ø§Ù…Û†Ø³ØªØ§</p></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="nav-pills">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchAdminTab('activities')" id="tab-admin-acts" class="pill active" data-i18n="manage_activities">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchAdminTab('teachers')" id="tab-admin-teach" class="pill" data-i18n="manage_teachers">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="adminActivitiesView" class="glass" style="padding:20px; background:var(--bg-card);"><table style="width:100%; border-collapse:collapse;"><thead><tr style="text-align:inherit; border-bottom:2px solid #eee;"><th style="padding:10px;" data-i18n="lbl_subject">Ø¨Ø§Ø¨Û•Øª</th><th data-i18n="lbl_teacher">Ù…Ø§Ù…Û†Ø³ØªØ§</th><th data-i18n="lbl_action">Ú©Ø±Ø¯Ø§Ø±</th></tr></thead><tbody id="adminActivitiesTable"></tbody></table></div>
Â  Â  Â  Â  Â  Â  <div id="adminTeachersView" class="glass" style="padding:20px; display:none; background:var(--bg-card);"><button onclick="openAddTeacherModal()" class="admin-link-btn" style="background:var(--primary); color:white; margin-bottom:20px;">â• <span data-i18n="btn_add_teacher">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</span></button><div id="adminTeachersGrid" class="teacher-grid"></div></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="editorModal" class="modal-overlay">
Â  Â  Â  Â  <div class="editor-container">
Â  Â  Â  Â  Â  Â  <div class="editor-toolbar">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeEditor()" style="color:#ef4444; font-weight:bold;" data-i18n="btn_close">Ø¯Ø§Ø®Ø³ØªÙ†</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;"><button onclick="setLayout('landscape')" style="background:#334155; padding:5px 10px; border-radius:5px;" data-i18n="layout_landscape">ÙˆÛÙ†Û•ÛŒ Ù¾Ø§Ù†</button><button onclick="setLayout('portrait')" style="background:#334155; padding:5px 10px; border-radius:5px;" data-i18n="layout_portrait">ÙˆÛÙ†Û•ÛŒ Ø¯Ø±ÛÚ˜</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;"><button onclick="window.print()" style="background:white; color:black; padding:5px 10px; border-radius:5px;">ğŸ–¨</button><button onclick="saveToArchive()" id="btnSaveArchive" style="background:var(--primary); color:white; padding:5px 15px; border-radius:5px;" data-i18n="btn_save">ğŸ’¾ Ø³Û•ÛŒÚ¤</button></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="paper-area">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="a4-page" id="reportPaper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h1 style="font-size:24px; color:black; margin:0;" data-i18n="school_name">Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</h1><p style="color:#666; margin-top:5px;" data-i18n="report_form">ÙÛ†Ø±Ù…ÛŒ Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="width:60px; height:60px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">LOGO</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-form">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label style="font-size:12px; color:#666;" data-i18n="lbl_subject">Ø¨Ø§Ø¨Û•Øª</label><input id="inpName" class="p-input"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label style="font-size:12px; color:#666;" data-i18n="lbl_committee">Ù„ÛŒÚ˜Ù†Û•</label><input id="inpComm" class="p-input"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label style="font-size:12px; color:#666;" data-i18n="lbl_teacher">Ù…Ø§Ù…Û†Ø³ØªØ§</label><select id="inpTeacher" class="p-input" style="background:white;"><option value="">...</option></select></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label style="font-size:12px; color:#666;" data-i18n="lbl_date">Ø¨Û•Ø±ÙˆØ§Ø±</label><input id="inpDate" type="date" class="p-input"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="inpNotes" style="width:100%; height:120px; border:1px solid #ddd; padding:10px; resize:none; font-family:inherit; margin-bottom:10px;" placeholder="..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="imgContainer" class="p-images landscape">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot" id="slot0" onmousedown="startDrag(event, 0)" ontouchstart="startDrag(event, 0)"><img id="img0"><div class="controls"><div class="c-btn" onclick="triggerFile(0)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(0, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(0, -0.1)">-</div></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot" id="slot1" onmousedown="startDrag(event, 1)" ontouchstart="startDrag(event, 1)"><img id="img1"><div class="controls"><div class="c-btn" onclick="triggerFile(1)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(1, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(1, -0.1)">-</div></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot" id="slot2" onmousedown="startDrag(event, 2)" ontouchstart="startDrag(event, 2)"><img id="img2"><div class="controls"><div class="c-btn" onclick="triggerFile(2)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(2, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(2, -0.1)">-</div></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot" id="slot3" onmousedown="startDrag(event, 3)" ontouchstart="startDrag(event, 3)"><img id="img3"><div class="controls"><div class="c-btn" onclick="triggerFile(3)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(3, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(3, -0.1)">-</div></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top:auto; text-align:center; font-size:12px; color:#999; border-top:1px solid #eee; padding-top:10px;" data-i18n="school_footer">Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯ÛŒ Ø¦ÛŒÙ†Ú¯Ù„ÛŒØ²ÛŒ Ù†Ø§Ø­Ú©ÙˆÙ…ÛŒ</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <input type="file" id="hiddenFileInput" accept="image/*" style="display:none;">

Â  Â  <div id="teacherEditModal" class="modal-overlay" style="z-index:9200;">
Â  Â  Â  Â  <div class="glass" style="background:white; padding:30px; width:90%; max-width:400px; border-radius:20px;">
Â  Â  Â  Â  Â  Â  <h3 style="margin-bottom:20px;" id="teacherModalTitle" data-i18n="teacher_info">Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</h3>
Â  Â  Â  Â  Â  Â  <input type="hidden" id="editTeacherId">
Â  Â  Â  Â  Â  Â  <label style="font-size:0.9em; color:gray;" data-i18n="lbl_name">Ù†Ø§Ùˆ</label>
Â  Â  Â  Â  Â  Â  <input id="editTeacherName" type="text" class="search-input" style="border:1px solid #ddd; margin:5px 0 15px; padding:10px;">
Â  Â  Â  Â  Â  Â  <label style="font-size:0.9em; color:gray;" data-i18n="lbl_gender">Ú•Û•Ú¯Û•Ø²</label>
Â  Â  Â  Â  Â  Â  <select id="editTeacherGender" class="search-input" style="border:1px solid #ddd; margin:5px 0 15px; padding:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="male">ğŸ‘¨â€ğŸ« Male</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="female">ğŸ‘©â€ğŸ« Female</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <label style="font-size:0.9em; color:gray;" data-i18n="lbl_photo">ÙˆÛÙ†Û•</label>
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px; align-items:center; margin-bottom:20px; flex-wrap:wrap;">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="editTeacherPreview" src="" style="width:50px; height:50px; border-radius:50%; border:1px solid #ddd; object-fit:contain; display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('editTeacherFile').click()" class="admin-link-btn" style="background:#e0e7ff; color:blue;" data-i18n="btn_change">ğŸ“· Ú¯Û†Ú•ÛŒÙ†</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeTeacherPhoto()" class="admin-link-btn" style="background:#fee2e2; color:red;" data-i18n="btn_remove_photo">âŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="editTeacherFile" style="display:none;" accept="image/*" onchange="previewTeacherImage(this)">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button onclick="saveTeacherChanges()" class="admin-link-btn" style="width:100%; justify-content:center; background:var(--primary); color:white; padding:12px;" data-i18n="btn_save">Ø³Û•ÛŒÚ¤Ú©Ø±Ø¯Ù†</button>
Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('teacherEditModal').classList.remove('active')" style="margin-top:10px; width:100%; color:#666;" data-i18n="btn_close">Ø¯Ø§Ø®Ø³ØªÙ†</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy, updateDoc, where, writeBatch, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
Â  Â  Â  Â Â 
Â  Â  Â  Â  const IMGBB_API_KEY = "0792200cd18a10eadeeccf373d03e4f7";Â 

Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyAr_JHCa5BbM5RJ9KCp0IBom1rdAgVX4CM",
Â  Â  Â  Â  Â  Â  authDomain: "gzng-f4273.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "gzng-f4273",
Â  Â  Â  Â  Â  Â  storageBucket: "gzng-f4273.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "417779309632",
Â  Â  Â  Â  Â  Â  appId: "1:417779309632:web:6ed119d26baa35822cd3a5",
Â  Â  Â  Â  Â  Â  measurementId: "G-B6V0CHGQV6"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const auth = getAuth(app);
Â  Â  Â  Â  const db = getFirestore(app);
Â  Â  Â  Â  const actRef = collection(db, "activities");
Â  Â  Â  Â  const teachRef = collection(db, "teachers");

Â  Â  Â  Â  let acts=[], teachers=[], user=null;
Â  Â  Â  Â  window.localFiles=[null,null,null,null]; window.currentSlot=0;
Â  Â  Â  Â  window.imgState={0:{s:1,x:0,y:0},1:{s:1,x:0,y:0},2:{s:1,x:0,y:0},3:{s:1,x:0,y:0}};
Â  Â  Â  Â  let currentFilter=null, tempTeacherFile = null, removePhotoFlag = false;

Â  Â  Â  Â  // NEW CLEAN VECTOR ICONS
Â  Â  Â  Â  const MALE_ICON = "https://cdn-icons-png.flaticon.com/512/4042/4042356.png";
Â  Â  Â  Â  const FEMALE_ICON = "https://cdn-icons-png.flaticon.com/512/4042/4042422.png";

Â  Â  Â  Â  // --- SITE ACCESS PASSWORD LOGIC ---
Â  Â  Â  Â  const SITE_ACCESS_PASSWORD = "2526"; // Ù¾Ø§Ø³Û†Ø±Ø¯Û•Ú©Û•ÛŒ Ø¦ÛØ³ØªØ§ 2526 ÛŒÛ•
        
Â  Â  Â  Â  window.checkSitePassword = () => {
Â  Â  Â  Â  Â  Â  const enteredPass = document.getElementById('sitePassword').value;
Â  Â  Â  Â  Â  Â  const errorMsg = document.getElementById('errorMsg');
Â  Â  Â  Â  Â  Â  const securityOverlay = document.getElementById('securityOverlay');
Â  Â  Â  Â  Â  Â  const mainContent = document.getElementById('mainContent');

Â  Â  Â  Â  Â  Â  if (enteredPass === SITE_ACCESS_PASSWORD) {
Â  Â  Â  Â  Â  Â  Â  Â  // Ø¦Û•Ú¯Û•Ø± Ù¾Ø§Ø³Û†Ø±Ø¯Û•Ú©Û• Ú•Ø§Ø³Øª Ø¨ÙˆÙˆ
Â  Â  Â  Â  Â  Â  Â  Â  securityOverlay.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  mainContent.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  errorMsg.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('siteAccessGranted', 'true'); // Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ø¬Ø§Ø±ÛÚ©ÛŒ ØªØ± Ù¾Ø§Ø³Û†Ø±Ø¯ Ù†Û•Ù¾Ø±Ø³ÛØªÛ•ÙˆÛ•
                // Load data after successful login
                fetchTeachers();
                fetchActivities();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Ø¦Û•Ú¯Û•Ø± Ù¾Ø§Ø³Û†Ø±Ø¯Û•Ú©Û• Ù‡Û•ÚµÛ• Ø¨ÙˆÙˆ
Â  Â  Â  Â  Â  Â  Â  Â  errorMsg.style.display = 'block';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Check if access was previously granted on page load
Â  Â  Â  Â  if (localStorage.getItem('siteAccessGranted') === 'true') {
Â  Â  Â  Â  Â  Â  document.getElementById('securityOverlay').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('mainContent').style.display = 'block';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Ø¦Û•Ú¯Û•Ø± Ù†Ø§ØŒ Ø´Ø§Ø´Û•ÛŒ Ù¾Ø§Ø±ÛØ²Ø±Ø§Ùˆ Ù†ÛŒØ´Ø§Ù† Ø¨Ø¯Û•
Â  Â  Â  Â  Â  Â  document.getElementById('securityOverlay').style.display = 'flex';
Â  Â  Â  Â  }
        // --- END SITE ACCESS LOGIC ---


Â  Â  Â  Â  // --- TRANSLATIONS ---
Â  Â  Â  Â  const translations = {
Â  Â  Â  Â  Â  Â  ku: {
Â  Â  Â  Â  Â  Â  Â  Â  app_title: "Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú¯Ø²Ù†Ú¯", btn_admin: "Ø¦Û•Ø¯Ù…ÛŒÙ†", tab_archive: "Ø¦Û•Ø±Ø´ÛŒÙ", tab_teachers: "Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†", btn_schedule: "Ø®Ø´ØªÛ•ÛŒ Ú•Û†Ú˜Ø§Ù†Û•",
Â  Â  Â  Â  Â  Â  Â  Â  btn_add_activity: "Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛ", btn_back: "Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•", dashboard: "Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯",
Â  Â  Â  Â  Â  Â  Â  Â  stat_activity: "Ú†Ø§Ù„Ø§Ú©ÛŒ", stat_teacher: "Ù…Ø§Ù…Û†Ø³ØªØ§", manage_activities: "Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†",
Â  Â  Â  Â  Â  Â  Â  Â  manage_teachers: "Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†", lbl_subject: "Ø¨Ø§Ø¨Û•Øª", lbl_teacher: "Ù…Ø§Ù…Û†Ø³ØªØ§", lbl_action: "Ú©Ø±Ø¯Ø§Ø±",
Â  Â  Â  Â  Â  Â  Â  Â  btn_add_teacher: "Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§", btn_back_site: "Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ø³Ø§ÛŒØª", btn_logout: "Ø¯Û•Ø±Ú†ÙˆÙˆÙ†",
Â  Â  Â  Â  Â  Â  Â  Â  btn_close: "Ø¯Ø§Ø®Ø³ØªÙ†", btn_save: "Ø³Û•ÛŒÚ¤", layout_landscape: "ÙˆÛÙ†Û•ÛŒ Ù¾Ø§Ù†", layout_portrait: "ÙˆÛÙ†Û•ÛŒ Ø¯Ø±ÛÚ˜",
Â  Â  Â  Â  Â  Â  Â  Â  school_name: "Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯", report_form: "ÙÛ†Ø±Ù…ÛŒ Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ", lbl_committee: "Ù„ÛŒÚ˜Ù†Û•", lbl_date: "Ø¨Û•Ø±ÙˆØ§Ø±",
Â  Â  Â  Â  Â  Â  Â  Â  school_footer: "Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯ÛŒ Ø¦ÛŒÙ†Ú¯Ù„ÛŒØ²ÛŒ Ù†Ø§Ø­Ú©ÙˆÙ…ÛŒ", teacher_info: "Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§", lbl_name: "Ù†Ø§Ùˆ", lbl_gender: "Ú•Û•Ú¯Û•Ø²",
Â  Â  Â  Â  Â  Â  Â  Â  lbl_photo: "ÙˆÛÙ†Û•", btn_change: "Ú¯Û†Ú•ÛŒÙ†", btn_remove_photo: "Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ ÙˆÛÙ†Û•", view_report: "Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú•Ø§Ù¾Û†Ø±Øª",
Â  Â  Â  Â  Â  Â  Â  Â  secure_area: "Ù†Ø§ÙˆÚ†Û•ÛŒ Ù¾Ø§Ø±ÛØ²Ø±Ø§Ùˆ", btn_login: "Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•", error_pass: "Ù¾Ø§Ø³Û†Ø±Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•", admin_login_title: "Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†", search: "Ú¯Û•Ú•Ø§Ù†...", delete_confirm: "Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ"
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  en: {
Â  Â  Â  Â  Â  Â  Â  Â  app_title: "Gzng Archive", btn_admin: "Admin", tab_archive: "Archive", tab_teachers: "Teachers", btn_schedule: "Daily Schedule",
Â  Â  Â  Â  Â  Â  Â  Â  btn_add_activity: "Add New Activity", btn_back: "Back", dashboard: "Dashboard",
Â  Â  Â  Â  Â  Â  Â  Â  stat_activity: "Activities", stat_teacher: "Teachers", manage_activities: "Manage Activities",
Â  Â  Â  Â  Â  Â  Â  Â  manage_teachers: "Manage Teachers", lbl_subject: "Subject", lbl_teacher: "Teacher", lbl_action: "Action",
Â  Â  Â  Â  Â  Â  Â  Â  btn_add_teacher: "Add Teacher", btn_back_site: "Back to Site", btn_logout: "Logout",
Â  Â  Â  Â  Â  Â  Â  Â  btn_close: "Close", btn_save: "Save", layout_landscape: "Landscape", layout_portrait: "Portrait",
Â  Â  Â  Â  Â  Â  Â  Â  school_name: "Gzng School", report_form: "Activity Report Form", lbl_committee: "Committee", lbl_date: "Date",
Â  Â  Â  Â  Â  Â  Â  Â  school_footer: "Gzng Non-Governmental English School", teacher_info: "Teacher Info", lbl_name: "Name", lbl_gender: "Gender",
Â  Â  Â  Â  Â  Â  Â  Â  lbl_photo: "Photo", btn_change: "Change", btn_remove_photo: "Remove Photo", view_report: "View Report",
Â  Â  Â  Â  Â  Â  Â  Â  secure_area: "Restricted Area", btn_login: "Login", error_pass: "Wrong Password", admin_login_title: "Admin Login", search: "Search...", delete_confirm: "Are you sure you want to delete?"
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  ar: {
Â  Â  Â  Â  Â  Â  Â  Â  app_title: "Ø£Ø±Ø´ÙŠÙ ØºØ²Ù†Ú¯", btn_admin: "Ø¥Ø¯Ø§Ø±Ø©", tab_archive: "Ø§Ù„Ø£Ø±Ø´ÙŠÙ", tab_teachers: "Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†", btn_schedule: "Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ",
Â  Â  Â  Â  Â  Â  Â  Â  btn_add_activity: "Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯", btn_back: "Ø±Ø¬ÙˆØ¹", dashboard: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
Â  Â  Â  Â  Â  Â  Â  Â  stat_activity: "Ø£Ù†Ø´Ø·Ø©", stat_teacher: "Ù…Ø¯Ø±Ø³ÙŠÙ†", manage_activities: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©",
Â  Â  Â  Â  Â  Â  Â  Â  manage_teachers: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†", lbl_subject: "Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹", lbl_teacher: "Ø§Ù„Ù…Ø¯Ø±Ø³", lbl_action: "Ø¥Ø¬Ø±Ø§Ø¡",
Â  Â  Â  Â  Â  Â  Â  Â  btn_add_teacher: "Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³", btn_back_site: "Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ÙˆÙ‚Ø¹", btn_logout: "Ø®Ø±ÙˆØ¬",
Â  Â  Â  Â  Â  Â  Â  Â  btn_close: "Ø¥ØºÙ„Ø§Ù‚", btn_save: "Ø­ÙØ¸", layout_landscape: "Ø¹Ø±Ø¶ÙŠ", layout_portrait: "Ø·ÙˆÙ„ÙŠ",
Â  Â  Â  Â  Â  Â  Â  Â  school_name: "Ù…Ø¯Ø±Ø³Ø© ØºØ²Ù†Ú¯", report_form: "Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± Ù†Ø´Ø§Ø·", lbl_committee: "Ø§Ù„Ù„Ø¬Ù†Ø©", lbl_date: "Ø§Ù„ØªØ§Ø±ÙŠØ®",
Â  Â  Â  Â  Â  Â  Â  Â  school_footer: "Ù…Ø¯Ø±Ø³Ø© ØºØ²Ù†Ú¯ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø§Ù„Ø£Ù‡Ù„ÙŠØ©", teacher_info: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³", lbl_name: "Ø§Ù„Ø§Ø³Ù…", lbl_gender: "Ø§Ù„Ø¬Ù†Ø³",
Â  Â  Â  Â  Â  Â  Â  Â  lbl_photo: "ØµÙˆØ±Ø©", btn_change: "ØªØºÙŠÙŠØ±", btn_remove_photo: "Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©", view_report: "Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±",
Â  Â  Â  Â  Â  Â  Â  Â  secure_area: "Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ù…ÙŠØ©", btn_login: "Ø¯Ø®ÙˆÙ„", error_pass: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£", admin_login_title: "Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù", search: "Ø¨Ø­Ø«...", delete_confirm: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ"
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Language Logic
Â  Â  Â  Â  window.toggleLangMenu = () => {
Â  Â  Â  Â  Â  Â  const menu = document.getElementById('langMenu');
Â  Â  Â  Â  Â  Â  menu.classList.toggle('show');
Â  Â  Â  Â  };
Â  Â  Â  Â  window.onclick = (e) => {
Â  Â  Â  Â  Â  Â  if (!e.target.matches('.icon-btn') && !e.target.matches('.icon-btn *')) {
Â  Â  Â  Â  Â  Â  Â  Â  const menu = document.getElementById('langMenu');
Â  Â  Â  Â  Â  Â  Â  Â  if (menu.classList.contains('show')) menu.classList.remove('show');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.setLang = (lang) => {
Â  Â  Â  Â  Â  Â  localStorage.setItem('lang', lang);
Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  };

Â  Â  Â  Â  let currentLang = localStorage.getItem('lang') || 'ku';
Â  Â  Â  Â  document.documentElement.setAttribute('lang', currentLang);
Â  Â  Â  Â  document.documentElement.setAttribute('dir', currentLang === 'en' ? 'ltr' : 'rtl');
Â  Â  Â  Â  function t(key) { return translations[currentLang][key] || key; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.querySelectorAll('[data-i18n]').forEach(el => {
Â  Â  Â  Â  Â  Â  const key = el.getAttribute('data-i18n');
Â  Â  Â  Â  Â  Â  if(translations[currentLang][key]) el.innerText = translations[currentLang][key];
Â  Â  Â  Â  });
        document.getElementById('searchBox').placeholder = t('search');
        document.getElementById('inpNotes').placeholder = t('note_placeholder') || '...';
        
Â  Â  Â  Â  // Theme Toggle Logic
Â  Â  Â  Â  function getTheme() { return document.documentElement.getAttribute('data-theme') || 'light'; }
Â  Â  Â  Â  function setTheme(theme) {
Â  Â  Â  Â  Â  Â  document.documentElement.setAttribute('data-theme', theme);
Â  Â  Â  Â  Â  Â  localStorage.setItem('theme', theme);
Â  Â  Â  Â  Â  Â  document.getElementById('themeIcon').innerText = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
Â  Â  Â  Â  }
Â  Â  Â  Â  window.toggleTheme = () => { setTheme(getTheme() === 'light' ? 'dark' : 'light'); };
Â  Â  Â  Â  setTheme(localStorage.getItem('theme') || 'light');

Â  Â  Â  Â  // --- Drag and Zoom Logic ---
Â  Â  Â  Â  let isDragging = false;
Â  Â  Â  Â  let currentImage = null;
Â  Â  Â  Â  let startX, startY;

Â  Â  Â  Â  window.startDrag = (e, slotIndex) => {
Â  Â  Â  Â  Â  Â  const imgEl = document.getElementById(`img${slotIndex}`);
Â  Â  Â  Â  Â  Â  if (!imgEl || !imgEl.src) return;

Â  Â  Â  Â  Â  Â  isDragging = true;
Â  Â  Â  Â  Â  Â  currentImage = imgEl;
Â  Â  Â  Â  Â  Â  currentImage.style.cursor = 'grabbing';

Â  Â  Â  Â  Â  Â  const clientX = e.clientX || e.touches[0].clientX;
Â  Â  Â  Â  Â  Â  const clientY = e.clientY || e.touches[0].clientY;

Â  Â  Â  Â  Â  Â  startX = clientX - imgState[slotIndex].x;
Â  Â  Â  Â  Â  Â  startY = clientY - imgState[slotIndex].y;

Â  Â  Â  Â  Â  Â  document.addEventListener('mousemove', drag);
Â  Â  Â  Â  Â  Â  document.addEventListener('mouseup', stopDrag);
Â  Â  Â  Â  Â  Â  document.addEventListener('touchmove', drag);
Â  Â  Â  Â  Â  Â  document.addEventListener('touchend', stopDrag);
Â  Â  Â  Â  };

Â  Â  Â  Â  const drag = (e) => {
Â  Â  Â  Â  Â  Â  if (!isDragging || !currentImage) return;
Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  const slotIndex = parseInt(currentImage.id.replace('img', ''));
Â  Â  Â  Â  Â  Â  const clientX = e.clientX || e.touches[0].clientX;
Â  Â  Â  Â  Â  Â  const clientY = e.clientY || e.touches[0].clientY;

Â  Â  Â  Â  Â  Â  imgState[slotIndex].x = clientX - startX;
Â  Â  Â  Â  Â  Â  imgState[slotIndex].y = clientY - startY;

Â  Â  Â  Â  Â  Â  applyTransform(slotIndex);
Â  Â  Â  Â  };

Â  Â  Â  Â  const stopDrag = () => {
Â  Â  Â  Â  Â  Â  isDragging = false;
Â  Â  Â  Â  Â  Â  if (currentImage) currentImage.style.cursor = 'grab';
Â  Â  Â  Â  Â  Â  currentImage = null;
Â  Â  Â  Â  Â  Â  document.removeEventListener('mousemove', drag);
Â  Â  Â  Â  Â  Â  document.removeEventListener('mouseup', stopDrag);
Â  Â  Â  Â  Â  Â  document.removeEventListener('touchmove', drag);
Â  Â  Â  Â  Â  Â  document.removeEventListener('touchend', stopDrag);
Â  Â  Â  Â  };

Â  Â  Â  Â  window.adjustZoom = (slotIndex, delta) => {
Â  Â  Â  Â  Â  Â  const newScale = Math.max(1, imgState[slotIndex].s + delta);
Â  Â  Â  Â  Â  Â  imgState[slotIndex].s = newScale;
Â  Â  Â  Â  Â  Â  applyTransform(slotIndex);
Â  Â  Â  Â  };

Â  Â  Â  Â  function applyTransform(slotIndex) {
Â  Â  Â  Â  Â  Â  const { x, y, s } = imgState[slotIndex];
Â  Â  Â  Â  Â  Â  const imgEl = document.getElementById(`img${slotIndex}`);
Â  Â  Â  Â  Â  Â  if (imgEl) imgEl.style.transform = `translate(${x}px, ${y}px) scale(${s})`;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- File Upload Logic ---
Â  Â  Â  Â  window.triggerFile = (slotIndex) => {
Â  Â  Â  Â  Â  Â  window.currentSlot = slotIndex;
Â  Â  Â  Â  Â  Â  document.getElementById('hiddenFileInput').click();
Â  Â  Â  Â  };

Â  Â  Â  Â  document.getElementById('hiddenFileInput').onchange = (e) => {
Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  if (file) {
Â  Â  Â  Â  Â  Â  Â  Â  window.localFiles[window.currentSlot] = file;
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imgEl = document.getElementById(`img${window.currentSlot}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgEl.src = event.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgEl.style.objectFit = 'cover';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgEl.style.cursor = 'grab';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgState[window.currentSlot] = {s:1, x:0, y:0};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  applyTransform(window.currentSlot);
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Editor Functions ---
Â  Â  Â  Â  function resetEditor() {
Â  Â  Â  Â  Â  Â  document.getElementById('inpName').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('inpComm').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('inpTeacher').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('inpDate').value = new Date().toISOString().substring(0, 10);
Â  Â  Â  Â  Â  Â  document.getElementById('inpNotes').value = '';
Â  Â  Â  Â  Â  Â  for (let i = 0; i < 4; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`img${i}`).src = '';
Â  Â  Â  Â  Â  Â  Â  Â  window.localFiles[i] = null;
Â  Â  Â  Â  Â  Â  Â  Â  imgState[i] = {s:1, x:0, y:0};
Â  Â  Â  Â  Â  Â  Â  Â  applyTransform(i);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('btnSaveArchive').setAttribute('data-mode', 'new');
Â  Â  Â  Â  Â  Â  document.getElementById('btnSaveArchive').removeAttribute('data-id');
Â  Â  Â  Â  Â  Â  setLayout('landscape');
Â  Â  Â  Â  }
Â  Â  Â  Â  window.openEditor = () => { resetEditor(); document.getElementById('editorModal').classList.add('active'); };
Â  Â  Â  Â  window.closeEditor = () => { document.getElementById('editorModal').classList.remove('active'); };
Â  Â  Â  Â  window.setLayout = (layout) => {
Â  Â  Â  Â  Â  Â  const paper = document.getElementById('reportPaper');
Â  Â  Â  Â  Â  Â  paper.style.width = layout === 'landscape' ? '297mm' : '210mm';
Â  Â  Â  Â  Â  Â  paper.style.minHeight = layout === 'landscape' ? '210mm' : '297mm';
Â  Â  Â  Â  Â  Â  document.getElementById('imgContainer').className = `p-images ${layout}`;
Â  Â  Â  Â  };

Â  Â  Â  Â  function populateTeachersInEditor() {
Â  Â  Â  Â  Â  Â  const select = document.getElementById('inpTeacher');
Â  Â  Â  Â  Â  Â  select.innerHTML = `<option value="">${t('lbl_teacher')}...</option>`;
Â  Â  Â  Â  Â  Â  teachers.forEach(t => {
Â  Â  Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  opt.value = t.id;
Â  Â  Â  Â  Â  Â  Â  Â  opt.textContent = t.name;
Â  Â  Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function uploadImage(file, index) {
Â  Â  Â  Â  Â  Â  if (!file) return { url: '', transform: imgState[index] };
Â  Â  Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  Â  Â  formData.append("image", file);

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  return { url: data.data.url, transform: imgState[index] };
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error uploading image:", error);
Â  Â  Â  Â  Â  Â  Â  Â  return { url: '', transform: imgState[index] };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.saveToArchive = async () => {
Â  Â  Â  Â  Â  Â  const name = document.getElementById('inpName').value;
Â  Â  Â  Â  Â  Â  const comm = document.getElementById('inpComm').value;
Â  Â  Â  Â  Â  Â  const teacherId = document.getElementById('inpTeacher').value;
Â  Â  Â  Â  Â  Â  const date = document.getElementById('inpDate').value;
Â  Â  Â  Â  Â  Â  const notes = document.getElementById('inpNotes').value;
Â  Â  Â  Â  Â  Â  const layout = document.getElementById('imgContainer').classList.contains('landscape') ? 'landscape' : 'portrait';

Â  Â  Â  Â  Â  Â  if (!name || !teacherId || !date) { alert("ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û• Ù¾ÛÙˆÛŒØ³ØªÛ•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ• (Ø¨Ø§Ø¨Û•ØªØŒ Ù…Ø§Ù…Û†Ø³ØªØ§ØŒ Ø¨Û•Ø±ÙˆØ§Ø±)"); return; }

Â  Â  Â  Â  Â  Â  const teacher = teachers.find(t => t.id === teacherId);
Â  Â  Â  Â  Â  Â  const teacherName = teacher ? teacher.name : "Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒ Ù†Ø§Ø¯ÛŒØ§Ø±";

Â  Â  Â  Â  Â  Â  const imagePromises = [];
Â  Â  Â  Â  Â  Â  for(let i=0; i<4; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  imagePromises.push(uploadImage(window.localFiles[i], i));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const imageResults = await Promise.all(imagePromises);

Â  Â  Â  Â  Â  Â  const activityData = {
Â  Â  Â  Â  Â  Â  Â  Â  name, comm, teacherId, teacherName, date, notes, layout,
Â  Â  Â  Â  Â  Â  Â  Â  images: imageResults.map(res => ({ url: res.url, transform: res.transform })),
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: new Date().getTime()
Â  Â  Â  Â  Â  Â  };
            
Â  Â  Â  Â  Â  Â  const mode = document.getElementById('btnSaveArchive').getAttribute('data-mode');
Â  Â  Â  Â  Â  Â  const id = document.getElementById('btnSaveArchive').getAttribute('data-id');

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (mode === 'edit' && id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "activities", id), activityData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Û• Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•!");
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(actRef, activityData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Û• Ø³Û•ÛŒÚ¤ Ú©Ø±Ø§!");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  closeEditor();
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error adding/updating document: ", e);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ø³Û•ÛŒÚ¤Ú©Ø±Ø¯Ù†!");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

        window.openEditEditor = (id) => {
            const activity = acts.find(a => a.id === id);
            if (!activity) return;

            resetEditor();
            document.getElementById('btnSaveArchive').setAttribute('data-mode', 'edit');
            document.getElementById('btnSaveArchive').setAttribute('data-id', id);

            document.getElementById('inpName').value = activity.name;
            document.getElementById('inpComm').value = activity.comm || '';
            document.getElementById('inpTeacher').value = activity.teacherId;
            document.getElementById('inpDate').value = activity.date;
            document.getElementById('inpNotes').value = activity.notes || '';
            setLayout(activity.layout || 'landscape');
            
            // Populate images from saved URLs and transforms
            activity.images.forEach((img, i) => {
                const imgEl = document.getElementById(`img${i}`);
                if (img.url) {
                    imgEl.src = img.url;
                    imgEl.style.objectFit = 'cover';
                    imgState[i] = img.transform || {s:1, x:0, y:0};
                    applyTransform(i);
                    // For editing existing images, we don't set a local file initially
                    // The user must re-upload to change the image.
                    window.localFiles[i] = null; 
                } else {
                     imgEl.src = '';
                }
            });

            document.getElementById('editorModal').classList.add('active');
        }

Â  Â  Â  Â  // --- Archive View Functions ---
Â  Â  Â  Â  function renderActivities(activityList) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('activitiesGrid');
Â  Â  Â  Â  Â  Â  container.innerHTML = activityList.length === 0 ? `<p style="text-align:center; margin-top:50px; color:var(--text-light);">${t('no_activities') || 'Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú© Ù†ÛŒÛŒÛ•.'}</p>` : '';

Â  Â  Â  Â  Â  Â  activityList.forEach(act => {
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'card';

Â  Â  Â  Â  Â  Â  Â  Â  const imgUrls = act.images.map(img => img.url).filter(url => url);
Â  Â  Â  Â  Â  Â  Â  Â  const imgGrid = `<div class="card-img-grid">${imgUrls.slice(0, 4).map(url => `<img src="${url}" alt="Activity Image">`).join('')}</div>`;
                
                // Truncate name if too long
                const displayTitle = act.name.length > 30 ? act.name.substring(0, 30) + '...' : act.name;

Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${imgUrls.length > 0 ? imgGrid : `<div class="card-img-grid" style="grid-template-columns:1fr; background:var(--primary); align-items:center; justify-content:center; color:white;">${t('no_image') || 'Ø¨Û ÙˆÛÙ†Û•'}</div>`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-title">${displayTitle}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-info">ğŸ“… ${act.date}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-info">ğŸ‘¤ <a href="#" onclick="filterByTeacher('${act.teacherId}')" style="color:var(--primary); text-decoration:none;">${act.teacherName}</a></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-footer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-card" onclick="openReportModal('${act.id}')">${t('view_report')}</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(card);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  window.filterActivities = () => {
Â  Â  Â  Â  Â  Â  const searchTerm = document.getElementById('searchBox').value.toLowerCase();
Â  Â  Â  Â  Â  Â  const filtered = acts.filter(act => {
Â  Â  Â  Â  Â  Â  Â  Â  const matchesSearch = act.name.toLowerCase().includes(searchTerm) || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  act.teacherName.toLowerCase().includes(searchTerm) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  act.comm.toLowerCase().includes(searchTerm);
Â  Â  Â  Â  Â  Â  Â  Â  const matchesFilter = currentFilter ? act.teacherId === currentFilter : true;
Â  Â  Â  Â  Â  Â  Â  Â  return matchesSearch && matchesFilter;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  renderActivities(filtered);
Â  Â  Â  Â  };

Â  Â  Â  Â  window.filterByTeacher = (teacherId) => {
Â  Â  Â  Â  Â  Â  currentFilter = teacherId;
Â  Â  Â  Â  Â  Â  const teacher = teachers.find(t => t.id === teacherId);
Â  Â  Â  Â  Â  Â  document.getElementById('filterName').innerText = teacher ? teacher.name : '';
Â  Â  Â  Â  Â  Â  document.getElementById('filterAvatarContainer').innerHTML = teacher ? `<img src="${teacher.photoUrl || (teacher.gender === 'female' ? FEMALE_ICON : MALE_ICON)}" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">` : '';
Â  Â  Â  Â  Â  Â  document.getElementById('archiveControls').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('filterHeader').style.display = 'flex';
Â  Â  Â  Â  Â  Â  window.filterActivities();
Â  Â  Â  Â  };

Â  Â  Â  Â  window.clearFilter = () => {
Â  Â  Â  Â  Â  Â  currentFilter = null;
Â  Â  Â  Â  Â  Â  document.getElementById('searchBox').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('filterHeader').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('archiveControls').style.display = 'block';
Â  Â  Â  Â  Â  Â  renderActivities(acts);
Â  Â  Â  Â  };

Â  Â  Â  Â  window.openReportModal = (id) => {
Â  Â  Â  Â  Â  Â  const activity = acts.find(a => a.id === id);
Â  Â  Â  Â  Â  Â  if (!activity) return;

Â  Â  Â  Â  Â  Â  // Setup Modal for Viewing (Same Editor modal repurposed)
Â  Â  Â  Â  Â  Â  resetEditor();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  document.getElementById('inpName').value = activity.name;
Â  Â  Â  Â  Â  Â  document.getElementById('inpComm').value = activity.comm || '';
Â  Â  Â  Â  Â  Â  document.getElementById('inpTeacher').innerHTML = `<option value="${activity.teacherId}">${activity.teacherName}</option>`;
Â  Â  Â  Â  Â  Â  document.getElementById('inpDate').value = activity.date;
Â  Â  Â  Â  Â  Â  document.getElementById('inpNotes').value = activity.notes || '';
Â  Â  Â  Â  Â  Â  setLayout(activity.layout || 'landscape');

Â  Â  Â  Â  Â  Â  // Disable inputs for view mode
Â  Â  Â  Â  Â  Â  document.getElementById('inpName').setAttribute('disabled', 'true');
Â  Â  Â  Â  Â  Â  document.getElementById('inpComm').setAttribute('disabled', 'true');
Â  Â  Â  Â  Â  Â  document.getElementById('inpTeacher').setAttribute('disabled', 'true');
Â  Â  Â  Â  Â  Â  document.getElementById('inpDate').setAttribute('disabled', 'true');
Â  Â  Â  Â  Â  Â  document.getElementById('inpNotes').setAttribute('disabled', 'true');
Â  Â  Â  Â  Â  Â  document.getElementById('btnSaveArchive').style.display = 'none'; // Hide save button

Â  Â  Â  Â  Â  Â  // Load images and transforms
Â  Â  Â  Â  Â  Â  activity.images.forEach((img, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  const imgEl = document.getElementById(`img${i}`);
Â  Â  Â  Â  Â  Â  Â  Â  if (img.url) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgEl.src = img.url;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgEl.style.objectFit = 'cover';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgState[i] = img.transform || {s:1, x:0, y:0};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  applyTransform(i);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgEl.src = '';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // Hide controls for view mode
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`slot${i}`).querySelector('.controls').style.display = 'none';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  document.getElementById('editorModal').classList.add('active');
Â  Â  Â  Â  };
        
        window.closeEditor = () => {
            document.getElementById('editorModal').classList.remove('active');
            // Re-enable inputs and show save button when closing
            document.getElementById('inpName').removeAttribute('disabled');
            document.getElementById('inpComm').removeAttribute('disabled');
            document.getElementById('inpTeacher').removeAttribute('disabled');
            document.getElementById('inpDate').removeAttribute('disabled');
            document.getElementById('inpNotes').removeAttribute('disabled');
            document.getElementById('btnSaveArchive').style.display = 'inline-block';
            for (let i = 0; i < 4; i++) {
                document.getElementById(`slot${i}`).querySelector('.controls').style.display = 'flex';
            }
            populateTeachersInEditor(); // Re-populate teacher dropdown with all options
        };


Â  Â  Â  Â  // --- Teacher View Functions ---
Â  Â  Â  Â  function renderTeachers(teacherList) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('teachersGrid');
Â  Â  Â  Â  Â  Â  container.innerHTML = teacherList.length === 0 ? `<p style="text-align:center; margin-top:50px; color:var(--text-light);">${t('no_teachers') || 'Ù‡ÛŒÚ† Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•.'}</p>` : '';

Â  Â  Â  Â  Â  Â  teacherList.forEach(t => {
Â  Â  Â  Â  Â  Â  Â  Â  const activityCount = acts.filter(a => a.teacherId === t.id).length;
Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'teacher-item';
Â  Â  Â  Â  Â  Â  Â  Â  item.onclick = () => filterByTeacher(t.id);
Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${t.photoUrl || (t.gender === 'female' ? FEMALE_ICON : MALE_ICON)}" class="avatar-lg" alt="${t.name}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin:5px 0 0;">${t.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size:0.8em; color:var(--text-light);">${activityCount} ${t('stat_activity')}</p>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(item);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- General UI/View Functions ---
Â  Â  Â  Â  window.switchView = (view) => {
Â  Â  Â  Â  Â  Â  document.getElementById('btn-archive').classList.remove('active');
Â  Â  Â  Â  Â  Â  document.getElementById('btn-teachers').classList.remove('active');
Â  Â  Â  Â  Â  Â  document.getElementById('archiveControls').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('filterHeader').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('activitiesGrid').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('teachersGrid').style.display = 'none';

Â  Â  Â  Â  Â  Â  if (view === 'archive') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('btn-archive').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('archiveControls').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('activitiesGrid').style.display = 'grid';
Â  Â  Â  Â  Â  Â  Â  Â  renderActivities(acts);
Â  Â  Â  Â  Â  Â  } else if (view === 'teachers') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('btn-teachers').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('teachersGrid').style.display = 'grid';
Â  Â  Â  Â  Â  Â  Â  Â  renderTeachers(teachers);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Admin Auth and UI ---
Â  Â  Â  Â  document.getElementById('adminBtn').onclick = () => {
Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  openAdminDashboard();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('adminAuthModal').classList.add('active');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  onAuthStateChanged(auth, (currentUser) => {
Â  Â  Â  Â  Â  Â  user = currentUser;
Â  Â  Â  Â  Â  Â  document.getElementById('btnAddActivity').style.display = user ? 'flex' : 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('adminBtn').innerHTML = user ? `<span>âš™ï¸</span> <span data-i18n="dashboard">${t('dashboard')}</span>` : `<span>ğŸ”‘</span> <span data-i18n="btn_admin">${t('btn_admin')}</span>`;
Â  Â  Â  Â  });

Â  Â  Â  Â  window.loginAdmin = () => {
Â  Â  Â  Â  Â  Â  const email = document.getElementById('adminEmail').value;
Â  Â  Â  Â  Â  Â  const password = document.getElementById('adminPass').value;
Â  Â  Â  Â  Â  Â  signInWithEmailAndPassword(auth, email, password)
Â  Â  Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('adminAuthModal').classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  openAdminDashboard();
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => { alert(`Ù‡Û•ÚµÛ•ÛŒ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•: ${error.message}`); });
Â  Â  Â  Â  };

Â  Â  Â  Â  window.logoutAdmin = () => {
Â  Â  Â  Â  Â  Â  signOut(auth).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  closeAdminDashboard();
Â  Â  Â  Â  Â  Â  Â  Â  alert("Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø¯Û•Ø±Ú†ÙˆÙˆÛŒØª!");
Â  Â  Â  Â  Â  Â  }).catch(error => { console.error("Logout Error:", error); });
Â  Â  Â  Â  };

Â  Â  Â  Â  window.openAdminDashboard = () => {
Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('adminDashboard').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  updateAdminDashboard();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.closeAdminDashboard = () => { document.getElementById('adminDashboard').style.display = 'none'; };

Â  Â  Â  Â  function updateAdminDashboard() {
Â  Â  Â  Â  Â  Â  document.getElementById('statActivities').innerText = acts.length;
Â  Â  Â  Â  Â  Â  document.getElementById('statTeachers').innerText = teachers.length;
Â  Â  Â  Â  Â  Â  renderAdminActivities(acts);
Â  Â  Â  Â  Â  Â  renderAdminTeachers(teachers);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.switchAdminTab = (tab) => {
Â  Â  Â  Â  Â  Â  document.getElementById('tab-admin-acts').classList.remove('active');
Â  Â  Â  Â  Â  Â  document.getElementById('tab-admin-teach').classList.remove('active');
Â  Â  Â  Â  Â  Â  document.getElementById('adminActivitiesView').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('adminTeachersView').style.display = 'none';

Â  Â  Â  Â  Â  Â  if (tab === 'activities') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('tab-admin-acts').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('adminActivitiesView').style.display = 'block';
Â  Â  Â  Â  Â  Â  } else if (tab === 'teachers') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('tab-admin-teach').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('adminTeachersView').style.display = 'block';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  function renderAdminActivities(activityList) {
Â  Â  Â  Â  Â  Â  const tbody = document.getElementById('adminActivitiesTable');
Â  Â  Â  Â  Â  Â  tbody.innerHTML = '';
Â  Â  Â  Â  Â  Â  activityList.forEach(act => {
Â  Â  Â  Â  Â  Â  Â  Â  const row = tbody.insertRow();
Â  Â  Â  Â  Â  Â  Â  Â  row.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="padding:10px 0;">${act.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${act.teacherName}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="openEditEditor('${act.id}')" style="color:blue; margin-right:5px;">Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteActivity('${act.id}')" style="color:red;">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  window.deleteActivity = async (id) => {
Â  Â  Â  Â  Â  Â  if (confirm(t('delete_confirm'))) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "activities", id));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Û• Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•.");
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error removing document: ", e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•!");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
        
Â  Â  Â  Â  function renderAdminTeachers(teacherList) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('adminTeachersGrid');
Â  Â  Â  Â  Â  Â  container.innerHTML = teacherList.length === 0 ? `<p style="text-align:center; margin-top:30px; color:var(--text-light);">${t('no_teachers') || 'Ù‡ÛŒÚ† Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•.'}</p>` : '';

Â  Â  Â  Â  Â  Â  teacherList.forEach(t => {
Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'teacher-item';
Â  Â  Â  Â  Â  Â  Â  Â  item.style.cursor = 'default';
Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${t.photoUrl || (t.gender === 'female' ? FEMALE_ICON : MALE_ICON)}" class="avatar-lg" alt="${t.name}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin:5px 0 0;">${t.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size:0.8em; color:var(--text-light);">${acts.filter(a => a.teacherId === t.id).length} ${t('stat_activity')}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="openEditTeacherModal('${t.id}')" style="color:blue; margin-right:5px;">Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteTeacher('${t.id}', '${t.name}')" style="color:red;">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(item);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
        
        // --- Teacher Management Modals ---
        window.openAddTeacherModal = () => {
             document.getElementById('teacherModalTitle').innerText = t('btn_add_teacher');
             document.getElementById('editTeacherId').value = '';
             document.getElementById('editTeacherName').value = '';
             document.getElementById('editTeacherGender').value = 'male';
             document.getElementById('editTeacherPreview').src = MALE_ICON;
             document.getElementById('editTeacherPreview').style.display = 'block';
             tempTeacherFile = null;
             removePhotoFlag = false;
             document.getElementById('teacherEditModal').classList.add('active');
        };

        window.openEditTeacherModal = (id) => {
            const teacher = teachers.find(t => t.id === id);
            if (!teacher) return;
            document.getElementById('teacherModalTitle').innerText = t('teacher_info');
            document.getElementById('editTeacherId').value = id;
            document.getElementById('editTeacherName').value = teacher.name;
            document.getElementById('editTeacherGender').value = teacher.gender;
            document.getElementById('editTeacherPreview').src = teacher.photoUrl || (teacher.gender === 'female' ? FEMALE_ICON : MALE_ICON);
            document.getElementById('editTeacherPreview').style.display = 'block';
            tempTeacherFile = null;
            removePhotoFlag = false;
            document.getElementById('teacherEditModal').classList.add('active');
        };

        window.previewTeacherImage = (input) => {
            const file = input.files[0];
            if (file) {
                tempTeacherFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('editTeacherPreview').src = e.target.result;
                    document.getElementById('editTeacherPreview').style.display = 'block';
                    removePhotoFlag = false;
                };
                reader.readAsDataURL(file);
            }
        };

        window.removeTeacherPhoto = () => {
             document.getElementById('editTeacherPreview').src = '';
             document.getElementById('editTeacherPreview').style.display = 'none';
             tempTeacherFile = null;
             removePhotoFlag = true;
        };

        window.saveTeacherChanges = async () => {
            const id = document.getElementById('editTeacherId').value;
            const name = document.getElementById('editTeacherName').value.trim();
            const gender = document.getElementById('editTeacherGender').value;
            if (!name) { alert("ØªÚ©Ø§ÛŒÛ• Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ Ø¨Ù†ÙˆÙˆØ³Û•!"); return; }

            let photoUrl = document.getElementById('editTeacherPreview').src;
            let teacherData = { name, gender };

            if (tempTeacherFile) {
                // Upload new photo
                const formData = new FormData();
                formData.append("image", tempTeacherFile);
                try {
                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                        method: "POST", body: formData
                    });
                    const data = await response.json();
                    teacherData.photoUrl = data.data.url;
                } catch (error) {
                    console.error("Error uploading teacher photo:", error);
                    alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•!");
                    return;
                }
            } else if (removePhotoFlag) {
                 teacherData.photoUrl = ''; // Clear photo
            } else if (photoUrl.startsWith('http')) {
                 teacherData.photoUrl = photoUrl; // Keep existing image if not changed
            }

            try {
                if (id) {
                    await updateDoc(doc(db, "teachers", id), teacherData);
                    alert("Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•!");
                } else {
                    await addDoc(teachRef, teacherData);
                    alert("Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒ Ù†ÙˆÛ Ø²ÛŒØ§Ø¯ Ú©Ø±Ø§!");
                }
                document.getElementById('teacherEditModal').classList.remove('active');
            } catch (e) {
                console.error("Error saving teacher: ", e);
                alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ø³Û•ÛŒÚ¤Ú©Ø±Ø¯Ù†ÛŒ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ!");
            }
        };
        
        window.deleteTeacher = async (id, name) => {
            const relatedActs = acts.filter(a => a.teacherId === id);
            if (relatedActs.length > 0) {
                alert(`Ù†Ø§ØªÙˆØ§Ù†ÛŒØª Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒ "${name}" Ø¨Ø³Ú•ÛŒØªÛ•ÙˆÛ• Ú†ÙˆÙ†Ú©Û• ${relatedActs.length} Ú†Ø§Ù„Ø§Ú©ÛŒ Ù¾Û•ÛŒÙˆÛ•Ø³ØªÛ• Ù¾ÛÛŒÛ•ÙˆÛ•!`);
                return;
            }
            if (confirm(t('delete_confirm'))) {
                try {
                    await deleteDoc(doc(db, "teachers", id));
                    alert("Ù…Ø§Ù…Û†Ø³ØªØ§ Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•.");
                } catch (e) {
                    console.error("Error removing teacher: ", e);
                    alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•!");
                }
            }
        };


Â  Â  Â  Â  // --- Firebase Data Fetching ---
Â  Â  Â  Â  function fetchActivities() {
Â  Â  Â  Â  Â  Â  const q = query(actRef, orderBy("createdAt", "desc"));
Â  Â  Â  Â  Â  Â  onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  acts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
Â  Â  Â  Â  Â  Â  Â  Â  renderActivities(acts);
Â  Â  Â  Â  Â  Â  Â  Â  updateAdminDashboard();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function fetchTeachers() {
Â  Â  Â  Â  Â  Â  const q = query(teachRef, orderBy("name"));
Â  Â  Â  Â  Â  Â  onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  teachers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
Â  Â  Â  Â  Â  Â  Â  Â  renderTeachers(teachers);
Â  Â  Â  Â  Â  Â  Â  Â  updateAdminDashboard();
Â  Â  Â  Â  Â  Â  Â  Â  populateTeachersInEditor();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
        
        // Initial data loading if access is granted
        if (localStorage.getItem('siteAccessGranted') === 'true') {
             fetchTeachers();
             fetchActivities();
        }

Â  Â  </script>
</body>
</html>
