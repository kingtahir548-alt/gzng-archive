<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†ÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4f46e5; --bg-color: #f3f4f6; --card-bg: #ffffff;
            --text-dark: #1e293b; --text-gray: #64748b; --shadow: 0 10px 30px -5px rgba(0,0,0,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Noto Sans Arabic', sans-serif; background-color: var(--bg-color); min-height: 100vh; padding: 15px; color: var(--text-dark); padding-bottom: 40px; }
        .container { max-width: 1200px; margin: 0 auto; display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        header { background: var(--card-bg); padding: 25px 15px; border-radius: 20px; box-shadow: var(--shadow); text-align: center; margin-bottom: 20px; position: relative; overflow: hidden; }
        header::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: linear-gradient(90deg, var(--primary), #ec4899); }
        h1 { font-size: 1.8em; margin-bottom: 5px; font-weight: 900; }
        
        .nav-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; background: white; padding: 6px; border-radius: 50px; width: fit-content; margin: 0 auto 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .tab-btn { background: transparent; color: var(--text-gray); border: none; padding: 10px 20px; border-radius: 40px; font-size: 13px; font-weight: 700; cursor: pointer; transition: 0.3s; font-family: 'Noto Sans Arabic'; }
        .tab-btn.active { background: var(--primary); color: white; }

        .controls { background: white; padding: 15px; border-radius: 16px; margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .search-box { flex: 1; padding: 14px 20px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 16px; font-family: 'Noto Sans Arabic'; background: #f8fafc; min-width: 200px; }
        .add-btn { background: linear-gradient(135deg, var(--primary), #4338ca); color: white; border: none; padding: 14px 25px; border-radius: 12px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2); display: flex; align-items: center; justify-content: center; gap: 8px; font-family: 'Noto Sans Arabic'; font-size: 16px; flex-grow: 1; }

        .activities-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .activity-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); transition: 0.3s; display: flex; flex-direction: column; position: relative; border: 1px solid #f1f5f9; }
        .activity-header { padding: 15px; background: white; border-bottom: 1px solid #f1f5f9; }
        .activity-header h3 { font-size: 1.2em; margin-bottom: 5px; color: var(--text-dark); }
        .committee-tag { background: #e0f2fe; color: #0284c7; padding: 4px 10px; border-radius: 8px; font-size: 0.8em; font-weight: bold; display: inline-block; margin-bottom: 5px; }
        
        .images-preview { height: 220px; overflow: hidden; display: grid; grid-template-columns: repeat(2, 1fr); gap: 1px; background: #f1f5f9; }
        .images-preview img { width: 100%; height: 100%; object-fit: cover; }

        .card-actions { padding: 15px; border-top: 1px solid #f1f5f9; display: flex; gap: 10px; background: #f8fafc; }
        .action-btn { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-family: 'Noto Sans Arabic'; font-size: 0.95em; transition: 0.2s; }
        .btn-report { background: #dbeafe; color: #2563eb; }
        .btn-delete { background: #fee2e2; color: #ef4444; display: none; } 

        /* Modal styles optimized for mobile */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; justify-content: center; align-items: center; padding: 15px; overflow-y: auto; backdrop-filter: blur(5px); }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 20px; padding: 20px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; margin: auto; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9em; color: #475569; }
        .form-group input, .form-group textarea { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-family: 'Noto Sans Arabic'; background: #f8fafc; font-size: 16px; }
        .save-btn { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; font-family: 'Noto Sans Arabic'; font-size: 16px; }

        /* Report A4 Styling */
        .report-container { background: white; width: 210mm; min-width: 210mm; margin: 0 auto; padding: 0; overflow: hidden; display: block; }
        .a4-paper { background: white; width: 100%; min-height: 297mm; padding: 20mm; position: relative; color: black; direction: rtl; text-align: right; box-sizing: border-box; }
        .report-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #1e293b; padding-bottom: 20px; margin-bottom: 30px; }
        .report-title h1 { font-size: 24px; font-weight: 900; margin: 0; color: #1e293b; }
        .report-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; background: #f8fafc; padding: 15px; border-radius: 10px; border: 1px solid #e2e8f0; }
        .report-images { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .report-img-box { aspect-ratio: 4/3; background: #eee; border-radius: 10px; overflow: hidden; border: 2px solid #e2e8f0; }
        .report-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .report-notes { background: #fffbeb; border: 1px solid #fcd34d; padding: 20px; border-radius: 10px; margin-bottom: 40px; min-height: 100px; }
        .report-footer { display: flex; justify-content: space-between; margin-top: 50px; padding-top: 20px; border-top: 2px solid #e2e8f0; }
        
        .admin-btn-top { position: absolute; top: 20px; left: 20px; background: #e2e8f0; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-family: 'Noto Sans Arabic'; font-size: 13px; font-weight: bold; }
        
        #globalLoader { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--primary); font-weight: bold; }

        /* Mobile Specific Fixes */
        @media (max-width: 600px) {
            .nav-tabs { width: 100%; padding: 5px; }
            .tab-btn { flex: 1; padding: 12px; font-size: 14px; }
            .controls { flex-direction: column; }
            .search-box, .add-btn { width: 100%; }
            .activity-card { margin-bottom: 10px; }
            /* Make report scrollable on mobile */
            #reportWrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; width: 100%; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 15px; }
        }
    </style>
</head>
<body>

    <div id="securityOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#1e293b; z-index:10000; display:flex; flex-direction:column; justify-content:center; align-items:center; padding: 20px;">
        <div style="background:white; padding:30px; border-radius:20px; text-align:center; width:100%; max-width:350px;">
            <h2>ğŸ”’ Ù¾Ø§Ø±ÛØ²Ø±Ø§Ùˆ</h2>
            <p style="color:#64748b; margin-bottom:15px;">ØªÚ©Ø§ÛŒÛ• ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ø¨Ù†ÙˆÙˆØ³Û•</p>
            <input type="password" id="sitePassword" style="width:100%; padding:14px; margin:10px 0 20px; text-align:center; font-size:18px; border:2px solid #e2e8f0; border-radius:10px; outline:none;" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
            <button onclick="checkPassword()" style="width:100%; padding:14px; background:#4f46e5; color:white; border:none; border-radius:10px; font-weight:bold; font-size:16px; cursor:pointer;">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <p id="errorMsg" style="color:red; margin-top:10px; display:none;">Ù‡Û•ÚµÛ•ÛŒÛ•!</p>
        </div>
    </div>

    <div id="globalLoader">Ø¬Ø§Ø±ÛŒ Ø¯Û•Ú©Ø±ÛØª...</div>

    <div class="container" id="mainContent">
        <header>
            <button onclick="toggleAdmin()" class="admin-btn-top" id="adminBtn">ğŸ”‘ Ø¦Û•Ø¯Ù…ÛŒÙ†</button>
            <h1>ğŸ« Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</h1>
            <p class="subtitle">Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†</p>
        </header>

        <div class="nav-tabs">
            <button onclick="switchView('archive')" class="tab-btn active" id="btn-archive">ğŸ  Ø¦Û•Ø±Ø´ÛŒÙ</button>
            <button onclick="switchView('teachers')" class="tab-btn" id="btn-teachers">ğŸ‘¨â€ğŸ« Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†</button>
        </div>

        <div class="controls" id="archiveControls">
            <input type="text" class="search-box" id="searchBox" placeholder="Ú¯Û•Ú•Ø§Ù†...">
            <button class="add-btn" onclick="openAddModal()">â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button>
        </div>

        <div class="activities-grid" id="activitiesGrid"></div>
        <div class="teachers-grid" id="teachersGrid" style="display:none; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;"></div>
    </div>

    <!-- Add Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <h2 style="text-align:center; margin-bottom:20px;">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛ</h2>
            <form id="activityForm">
                <div class="form-group"><label>Ù†Ø§ÙˆÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ</label><input type="text" id="activityName" required placeholder="Ù†Ù…ÙˆÙˆÙ†Û•: Ø³ÛŒÙ…ÛŒÙ†Ø§Ø±"></div>
                <div class="form-group"><label>Ù„ÛŒÚ˜Ù†Û•</label><input type="text" id="committeeName" required placeholder="Ù†Ù…ÙˆÙˆÙ†Û•: Ù„ÛŒÚ˜Ù†Û•ÛŒ Ú•Û†Ø´Ù†Ø¨ÛŒØ±ÛŒ"></div>
                <div class="form-group"><label>Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</label><input type="text" id="teacherName" required placeholder="Ù†Ø§ÙˆÛŒ Ø³ÛŒØ§Ù†ÛŒ..."></div>
                <div class="form-group"><label>Ø¨Û•Ø±ÙˆØ§Ø±</label><input type="date" id="activityDate" required></div>
                <div class="form-group">
                    <label>ÙˆÛÙ†Û•Ú©Ø§Ù† (Ù…Ø§Ú©Ø³ Ù¤)</label>
                    <input type="file" id="imageInput" accept="image/*" multiple style="width:100%; padding:10px; background:#f1f5f9; border-radius:10px;">
                    <div id="uploadStatus" style="color: blue; margin-top:5px; font-size:0.8em;"></div>
                </div>
                <div class="form-group"><label>ØªÛØ¨ÛŒÙ†ÛŒ</label><textarea id="activityNotes" rows="3"></textarea></div>
                <button type="submit" class="save-btn" id="saveBtn">ğŸ’¾ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†</button>
                <button type="button" onclick="closeAddModal()" style="width:100%; padding:15px; background:none; border:none; color:#64748b; cursor:pointer; margin-top:5px; font-weight:bold;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
            </form>
        </div>
    </div>

    <!-- Report Modal (Mobile Optimized Scroll) -->
    <div class="modal" id="reportModal" style="align-items: flex-start; padding-top: 20px;">
        <div style="width: 100%; max-width: 220mm;">
            <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                <button onclick="downloadReport()" style="background: #f97316; color: white; padding: 12px 25px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3);">â¬‡ï¸ Ø¯Ø§Ø¨Û•Ø²Ø§Ù†Ø¯Ù† (JPG)</button>
                <button onclick="document.getElementById('reportModal').classList.remove('active')" style="background: white; color: #64748b; padding: 12px 25px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
            </div>
            
            <div style="background: #333; padding: 10px; border-radius: 10px; color: white; font-size: 12px; text-align: center; margin-bottom: 10px; display: none;" id="mobileHint">
                â†”ï¸ Ø¯Û•ØªÙˆØ§Ù†ÛŒØª Ú•Ø§Ù¾Û†Ø±ØªÛ•Ú©Û• Ø¨Û• Ù„Ø§ÛŒ Ú•Ø§Ø³Øª Ùˆ Ú†Û•Ù¾Ø¯Ø§ Ø¨Ø¨Û•ÛŒØª
            </div>

            <!-- Scrollable Wrapper for Mobile -->
            <div id="reportWrapper">
                <div class="report-container" id="printArea">
                    <div class="a4-paper">
                        <div class="report-header">
                            <div class="report-title">
                                <h1>Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</h1>
                                <p>Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†</p>
                            </div>
                            <div style="width:70px; height:70px; background:#f1f5f9; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; border: 2px solid #e2e8f0;">LOGO</div>
                        </div>

                        <div class="report-meta">
                            <div class="meta-item"><strong>Ø¨Ø§Ø¨Û•Øª/Ú†Ø§Ù„Ø§Ú©ÛŒ</strong><span id="rep-name">...</span></div>
                            <div class="meta-item"><strong>Ù„ÛŒÚ˜Ù†Û•</strong><span id="rep-committee">...</span></div>
                            <div class="meta-item"><strong>Ø³Û•Ø±Ù¾Û•Ø±Ø´ØªÛŒØ§Ø±/Ù…Ø§Ù…Û†Ø³ØªØ§</strong><span id="rep-teacher">...</span></div>
                            <div class="meta-item"><strong>Ø¨Û•Ø±ÙˆØ§Ø±</strong><span id="rep-date">...</span></div>
                        </div>

                        <div class="report-images" id="rep-images"></div>

                        <div style="margin-bottom: 5px; font-weight: bold; color: #64748b;">ØªÛØ¨ÛŒÙ†ÛŒ Ùˆ ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ:</div>
                        <div class="report-notes" id="rep-notes">...</div>

                        <div class="report-footer">
                            <div class="signature"><p>Ø¦Ø§Ù…Ø§Ø¯Û•Ú©Ø±Ø¯Ù†ÛŒ</p><div class="signature-line"></div></div>
                            <div class="signature"><p>Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±ÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•</p><div class="signature-line"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAr_JHCa5BbM5RJ9KCp0IBom1rdAgVX4CM",
            authDomain: "gzng-f4273.firebaseapp.com",
            projectId: "gzng-f4273",
            storageBucket: "gzng-f4273.firebasestorage.app",
            messagingSenderId: "417779309632",
            appId: "1:417779309632:web:6ed119d26baa35822cd3a5",
            measurementId: "G-B6V0CHGQV6"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const activitiesRef = collection(db, "activities");

        let allActivities = [];
        window.isAdmin = false;

        const q = query(activitiesRef, orderBy("date", "desc"));
        onSnapshot(q, (snapshot) => {
            allActivities = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderApp();
            document.getElementById('globalLoader').style.display = 'none';
        });

        function renderApp() {
            const grid = document.getElementById('activitiesGrid');
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            
            const displayList = allActivities.filter(a => 
                a.name.toLowerCase().includes(searchTerm) || 
                a.teacher.toLowerCase().includes(searchTerm) ||
                (a.committee && a.committee.toLowerCase().includes(searchTerm))
            );

            grid.innerHTML = displayList.map(act => `
                <div class="activity-card">
                    <div class="activity-header">
                        <span class="committee-tag">${act.committee || 'Ú¯Ø´ØªÛŒ'}</span>
                        <h3>${act.name}</h3>
                        <div style="display:flex; justify-content:space-between; font-size:0.85em; color:#64748b;">
                            <span>ğŸ‘¤ ${act.teacher}</span>
                            <span>ğŸ“… ${act.date}</span>
                        </div>
                    </div>
                    <div class="images-preview">
                        ${act.images ? act.images.slice(0,4).map(url => `<img src="${url}">`).join('') : ''}
                    </div>
                    <div class="card-actions">
                        <button class="action-btn btn-report" onclick="openReport('${act.id}')">ğŸ“„ Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ú•Ø§Ù¾Û†Ø±Øª</button>
                        ${window.isAdmin ? `<button class="action-btn btn-delete" style="display:block" onclick="deleteItem('${act.id}')">ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>` : ''}
                    </div>
                </div>
            `).join('');

            if(displayList.length === 0) grid.innerHTML = '<p style="grid-column:1/-1; text-align:center;">Ù‡ÛŒÚ† Ù†ÛŒÛŒÛ•</p>';
            
            const tGrid = document.getElementById('teachersGrid');
            const tMap = {};
            allActivities.forEach(a => { const t = a.teacher.trim(); tMap[t] = (tMap[t] || 0) + 1; });
            tGrid.innerHTML = Object.keys(tMap).map(t => `
                <div style="background:white; padding:20px; border-radius:15px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
                    <div style="font-size:30px; margin-bottom:10px;">ğŸ‘¤</div>
                    <h3>${t}</h3>
                    <p style="color:#64748b; font-weight:bold;">${tMap[t]} Ú†Ø§Ù„Ø§Ú©ÛŒ</p>
                </div>
            `).join('');
        }

        async function uploadImage(file) {
            try {
                const storageRef = ref(storage, 'images/' + Date.now() + '-' + Math.floor(Math.random()*1000));
                const snapshot = await uploadBytes(storageRef, file);
                return await getDownloadURL(snapshot.ref);
            } catch (error) {
                console.error("Upload failed:", error);
                throw new Error("ÙˆÛÙ†Û•Ú©Û• Ø¦Ø§Ù¾Ù„Û†Ø¯ Ù†Û•Ø¨ÙˆÙˆ. ØªÚ©Ø§ÛŒÛ• Ø¯ÚµÙ†ÛŒØ§Ø¨Û• Ø¦ÛŒÙ†ØªÛ•Ø±Ù†ÛØª Ù‡Û•ÛŒÛ•.");
            }
        }

        document.getElementById('activityForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const saveBtn = document.getElementById('saveBtn');
            const statusDiv = document.getElementById('uploadStatus');
            saveBtn.disabled = true;
            saveBtn.textContent = 'â³ ØªÚ©Ø§ÛŒÛ• Ú†Ø§ÙˆÛ•Ú•ÛØ¨Û•...';
            
            try {
                const imageFiles = document.getElementById('imageInput').files;
                let imageUrls = [];
                
                if(imageFiles.length > 0) {
                    for(let i=0; i<imageFiles.length; i++) {
                        statusDiv.textContent = `Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•ÛŒ ${i+1}...`;
                        const url = await uploadImage(imageFiles[i]);
                        imageUrls.push(url);
                    }
                }
                
                await addDoc(activitiesRef, {
                    name: document.getElementById('activityName').value,
                    committee: document.getElementById('committeeName').value,
                    teacher: document.getElementById('teacherName').value.trim(),
                    date: document.getElementById('activityDate').value,
                    notes: document.getElementById('activityNotes').value,
                    images: imageUrls,
                    createdAt: new Date()
                });

                closeAddModal();
                alert("âœ… Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§!");
            } catch (error) {
                alert("Ù‡Û•ÚµÛ•: " + error.message);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'ğŸ’¾ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†';
                statusDiv.textContent = '';
            }
        });

        window.openReport = (id) => {
            const act = allActivities.find(a => a.id === id);
            if(!act) return;

            document.getElementById('rep-name').textContent = act.name;
            document.getElementById('rep-committee').textContent = act.committee || '---';
            document.getElementById('rep-teacher').textContent = act.teacher;
            document.getElementById('rep-date').textContent = act.date;
            document.getElementById('rep-notes').textContent = act.notes || 'Ù‡ÛŒÚ† ØªÛØ¨ÛŒÙ†ÛŒÛŒÛ•Ú© Ù†ÛŒÛŒÛ•.';
            
            const imgContainer = document.getElementById('rep-images');
            imgContainer.innerHTML = act.images ? act.images.map(url => 
                `<div class="report-img-box"><img src="${url}" crossorigin="anonymous"></div>`
            ).join('') : '';

            const modal = document.getElementById('reportModal');
            modal.classList.add('active');
            
            if(window.innerWidth < 600) {
                document.getElementById('mobileHint').style.display = 'block';
            }
        };

        window.downloadReport = () => {
            const element = document.querySelector(".a4-paper");
            html2canvas(element, { useCORS: true, scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Report.jpg';
                link.href = canvas.toDataURL("image/jpeg", 0.9);
                link.click();
            }).catch(err => alert("Ú©ÛØ´Û• Ù„Û• Ø¯Ø§Ø¨Û•Ø²Ø§Ù†Ø¯Ù†: " + err));
        };

        window.openAddModal = () => document.getElementById('addModal').classList.add('active');
        window.closeAddModal = () => { document.getElementById('addModal').classList.remove('active'); document.getElementById('activityForm').reset(); };
        window.switchView = (v) => {
            document.getElementById('activitiesGrid').style.display = v==='archive'?'grid':'none';
            document.getElementById('archiveControls').style.display = v==='archive'?'flex':'none';
            document.getElementById('teachersGrid').style.display = v==='teachers'?'grid':'none';
            document.getElementById('btn-archive').classList.toggle('active', v==='archive');
            document.getElementById('btn-teachers').classList.toggle('active', v==='teachers');
        };
        window.deleteItem = async (id) => { if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØªØŸ")) await deleteDoc(doc(db, "activities", id)); };
    </script>

    <script>
        function checkPassword() {
            if(document.getElementById('sitePassword').value === "2526") { 
                document.getElementById('securityOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } else { document.getElementById('errorMsg').style.display = 'block'; }
        }
        function toggleAdmin() {
            if(window.isAdmin) {
                window.isAdmin = false; document.getElementById('adminBtn').style.background="#e2e8f0";
                window.renderApp();
                alert("Ø¯Û•Ø±Ú†ÙˆÙˆÛŒØª.");
            } else {
                if(prompt("Ù¾Ø§Ø³Û†Ø±Ø¯ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†:") === "2324") {
                    window.isAdmin = true; document.getElementById('adminBtn').style.background="#86efac";
                    window.renderApp();
                    alert("Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒØª Ø¦Û•Ø¯Ù…ÛŒÙ†.");
                } else alert("Ù‡Û•ÚµÛ•ÛŒÛ•!");
            }
        }
    </script>
</body>
</html>
