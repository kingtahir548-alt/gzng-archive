<!DOCTYPE html>
<html lang="ku" dir="rtl" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú¯Ø²Ù†Ú¯ | Gzng Archive</title>
    <link href="https://fonts.googleapis.com/css2?family=Rudaw:wght@400;700;900&family=Noto+Sans+Arabic:wght@300;400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            /* Light Theme */
            --bg-body: #f0f2f5;
            --bg-glass: rgba(255, 255, 255, 0.85);
            --bg-nav: rgba(255, 255, 255, 0.9);
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-light: #64748b;
            --primary: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            --shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
            --border: 1px solid rgba(255, 255, 255, 0.6);
            --blur: blur(12px);
            --radius: 20px;
        }

        [data-theme="dark"] {
            /* Dark Theme */
            --bg-body: #0f172a;
            --bg-glass: rgba(30, 41, 59, 0.75);
            --bg-nav: rgba(15, 23, 42, 0.9);
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-light: #94a3b8;
            --primary: #818cf8;
            --primary-gradient: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);
            --shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
            --border: 1px solid rgba(255, 255, 255, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            font-family: 'Noto Sans Arabic', sans-serif; 
            background-color: var(--bg-body); 
            background-image: radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(168, 85, 247, 0.15) 0px, transparent 50%);
            background-attachment: fixed;
            min-height: 100vh; 
            color: var(--text-main);
            overflow-x: hidden;
            padding-top: 80px; /* Space for Fixed Navbar */
            padding-bottom: 40px;
            transition: background-color 0.5s ease;
        }

        /* --- UI COMPONENTS --- */
        .glass {
            background: var(--bg-glass);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        button { cursor: pointer; font-family: inherit; border: none; background: none; }

        /* --- NAVBAR (NEW ADDITION) --- */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            background: var(--bg-nav); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-bottom: var(--border);
            padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            transition: 0.3s;
        }

        .nav-brand { font-size: 1.4em; font-weight: 900; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: flex; align-items: center; gap: 10px; }
        .nav-logo-icon { width: 38px; height: 38px; background: var(--primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3); }

        .nav-right { display: flex; align-items: center; gap: 12px; }

        .theme-toggle {
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2em; transition: 0.3s; color: var(--text-main);
        }
        .theme-toggle:hover { background: rgba(128,128,128,0.1); transform: rotate(15deg); }

        .admin-link-btn {
            background: rgba(128,128,128,0.08); color: var(--text-main); padding: 8px 16px; border-radius: 50px;
            font-weight: bold; font-size: 0.9em; display: flex; align-items: center; gap: 6px; transition: 0.3s;
        }
        .admin-link-btn:hover { background: var(--primary); color: white; }

        /* --- MAIN CONTAINER --- */
        .container { max-width: 1200px; margin: 0 auto; width: 95%; animation: fadeIn 0.6s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Navigation Pills (Center) */
        .nav-pills { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; margin-top: 10px; }
        .pill {
            padding: 10px 25px; border-radius: 50px; font-weight: bold; color: var(--text-light);
            background: var(--bg-card); border: var(--border); transition: 0.3s; box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }
        .pill.active { background: var(--primary); color: white; box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3); transform: scale(1.05); }
        .pill:hover:not(.active) { background: rgba(128,128,128,0.1); }

        /* Search & Filter */
        .search-area { max-width: 600px; margin: 0 auto 30px; position: relative; }
        .search-input {
            width: 100%; padding: 16px 25px; border-radius: 50px; border: var(--border);
            background: var(--bg-card); color: var(--text-main); font-size: 1.1em;
            box-shadow: var(--shadow); transition: 0.3s;
        }
        .search-input:focus { transform: scale(1.02); box-shadow: 0 15px 40px rgba(0,0,0,0.1); }

        .filter-header { 
            display: none; align-items: center; justify-content: space-between; padding: 15px; margin-bottom: 25px;
            background: var(--bg-card); border-radius: 15px; border: var(--border);
        }

        /* --- CARDS & GRIDS --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        
        .card { 
            background: var(--bg-card); border-radius: 20px; overflow: hidden; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: var(--border);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column;
        }
        .card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px -5px rgba(0,0,0,0.1); }
        
        .card-img-grid { display: grid; grid-template-columns: 1fr 1fr; height: 200px; gap: 1px; background: var(--bg-body); }
        .card-img-grid img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-body { padding: 20px; flex-grow: 1; }
        .card-title { font-weight: 800; font-size: 1.1em; margin-bottom: 8px; color: var(--text-main); }
        .card-info { font-size: 0.85em; color: var(--text-light); display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        .card-footer { padding: 15px; background: rgba(128,128,128,0.03); border-top: 1px solid rgba(128,128,128,0.05); }
        
        .btn-card { 
            width: 100%; padding: 10px; border-radius: 12px; background: rgba(99, 102, 241, 0.1); 
            color: var(--primary); font-weight: bold; transition: 0.2s; 
        }
        .btn-card:hover { background: var(--primary); color: white; }

        /* Teachers Grid */
        .teacher-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .teacher-item { 
            text-align: center; padding: 25px 10px; background: var(--bg-card); 
            border-radius: 25px; transition: 0.3s; border: var(--border); cursor: pointer; 
        }
        .teacher-item:hover { transform: translateY(-5px); border-color: var(--primary); }
        .avatar-lg { width: 90px; height: 90px; border-radius: 50%; margin: 0 auto 15px; object-fit: cover; border: 3px solid var(--primary); padding: 3px; background: var(--bg-body); }

        /* --- ADMIN DASHBOARD (FULL SCREEN) --- */
        .admin-dashboard {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); z-index: 2000; overflow-y: auto; display: none;
        }
        .admin-nav {
            position: sticky; top: 0; background: #1e293b; color: white; padding: 15px 25px;
            display: flex; justify-content: space-between; align-items: center; z-index: 10;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        /* --- EDITOR MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(5px);
            z-index: 3000; display: none; overflow-y: auto; padding: 20px 0;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.active { display: block; opacity: 1; }
        
        .editor-container { width: 95%; max-width: 1000px; margin: 0 auto; display: flex; flex-direction: column; gap: 20px; }
        .editor-toolbar { background: #1e293b; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 10; }
        
        /* Paper Styles (Keep Exact) */
        .paper-area { background: #334155; padding: 30px; border-radius: 20px; display: flex; justify-content: center; overflow-x: auto; }
        .a4-page { width: 210mm; min-height: 297mm; background: white; padding: 15mm; color: black; direction: rtl; text-align: right; display: flex; flex-direction: column; position: relative; }
        .p-header { display: flex; justify-content: space-between; border-bottom: 3px solid black; padding-bottom: 15px; margin-bottom: 20px; }
        .p-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #f8fafc; padding: 15px; border: 1px solid #e2e8f0; margin-bottom: 20px; }
        .p-input { width: 100%; border: none; border-bottom: 1px dashed #cbd5e1; background: transparent; font-weight: bold; padding: 2px; }
        .p-images { display: grid; gap: 10px; margin-top: 20px; }
        .p-images.landscape { grid-template-columns: 1fr 1fr; } .p-images.landscape .slot { height: 180px; }
        .p-images.portrait { grid-template-columns: 1fr 1fr; } .p-images.portrait .slot { height: 280px; }
        .slot { background: #f1f5f9; border: 2px dashed #cbd5e1; border-radius: 8px; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .slot img { width: 100%; height: 100%; object-fit: contain; }
        .controls { position: absolute; bottom: 5px; display: flex; gap: 5px; background: rgba(0,0,0,0.6); padding: 5px; border-radius: 20px; opacity: 0; transition: 0.2s; }
        .slot:hover .controls { opacity: 1; }
        .c-btn { width: 25px; height: 25px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        @media print {
            body * { visibility: hidden; }
            .a4-page, .a4-page * { visibility: visible; }
            .a4-page { position: absolute; left: 0; top: 0; margin: 0; padding: 10mm; width: 210mm; height: 297mm; }
            .controls, .editor-toolbar, .modal-overlay { display: none !important; }
        }
        
        @media (max-width: 768px) {
            .nav-brand span { font-size: 0.9em; }
            .a4-page { width: 100%; height: auto; aspect-ratio: 210/297; padding: 5mm; }
            .p-images.landscape .slot { height: 120px; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-brand">
            <div class="nav-logo-icon">ğŸ«</div>
            <span>Ø¦Û•Ø±Ø´ÛŒÙÛŒ Ú¯Ø²Ù†Ú¯</span>
        </div>
        
        <div class="nav-right">
            <button onclick="toggleTheme()" class="theme-toggle" id="themeIcon">ğŸŒ™</button>
            <button id="adminBtn" class="admin-link-btn">
                <span>ğŸ”‘</span> <span style="font-size:0.9em;">Ø¦Û•Ø¯Ù…ÛŒÙ†</span>
            </button>
        </div>
    </nav>

    <div id="securityOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; z-index:9999; display:flex; justify-content:center; align-items:center;">
        <div class="glass" style="padding:40px; text-align:center; max-width:300px; width:90%; background:white;">
            <div style="font-size:3em; margin-bottom:10px;">ğŸ”’</div>
            <h2 style="margin-bottom:20px; color:#333;">Ù¾Ø§Ø±ÛØ²Ø±Ø§Ùˆ</h2>
            <input type="password" id="sitePassword" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:10px; margin-bottom:15px; text-align:center;">
            <button onclick="checkSitePassword()" class="admin-link-btn" style="width:100%; justify-content:center; background:var(--primary); color:white;">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <p id="errorMsg" style="color:red; margin-top:10px; display:none;">Ù‡Û•ÚµÛ•ÛŒÛ•</p>
        </div>
    </div>

    <div id="adminAuthModal" class="modal-overlay" style="z-index:9000; align-items:center; justify-content:center; display:none;">
        <div class="glass" style="background:white; padding:30px; width:90%; max-width:350px; text-align:center; position:relative; top:10%;">
            <h3>Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±</h3>
            <input type="email" id="adminEmail" placeholder="Ø¦ÛŒÙ…Û•ÛŒÚµ" class="search-input" style="margin:15px 0 10px; border:1px solid #ddd;">
            <input type="password" id="adminPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯" class="search-input" style="margin-bottom:20px; border:1px solid #ddd;">
            <button onclick="loginAdmin()" class="admin-link-btn" style="width:100%; justify-content:center; background:var(--primary); color:white;">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <button onclick="document.getElementById('adminAuthModal').style.display='none'" style="margin-top:15px; color:#666;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
        </div>
    </div>

    <div id="mainContent" style="display:none;">
        <div class="container">
            <div class="nav-pills">
                <button onclick="switchView('archive')" class="pill active" id="btn-archive">Ø¦Û•Ø±Ø´ÛŒÙ</button>
                <button onclick="switchView('teachers')" class="pill" id="btn-teachers">Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†</button>
            </div>

            <div id="archiveControls">
                <div class="search-area">
                    <input type="text" class="search-input" id="searchBox" placeholder="Ú¯Û•Ú•Ø§Ù†...">
                </div>
                <div style="text-align:center;">
                    <button onclick="openEditor()" class="admin-link-btn" id="btnAddActivity" style="display:none; margin: 0 auto; background:var(--primary); color:white; padding:12px 25px;">
                        <span>â•</span> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛ
                    </button>
                </div>
            </div>

            <div id="filterHeader" class="filter-header">
                <div style="display:flex; align-items:center; gap:15px;">
                    <div id="filterAvatarContainer"></div>
                    <h2 id="filterName" style="font-size:1.2em; margin:0;"></h2>
                </div>
                <button onclick="clearFilter()" style="color:#ef4444; background:rgba(239, 68, 68, 0.1); padding:8px 15px; border-radius:10px;">âŒ Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
            </div>

            <div id="activitiesGrid" class="grid"></div>
            <div id="teachersGrid" class="teacher-grid" style="display:none;"></div>
        </div>
    </div>

    <div id="adminDashboard" class="admin-dashboard">
        <div class="admin-nav">
            <h2 style="display:flex; align-items:center; gap:10px;">âš™ï¸ Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯ <span style="font-size:0.6em; background:#334155; padding:2px 8px; border-radius:10px;">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±</span></h2>
            <div style="display:flex; gap:10px;">
                <button onclick="closeAdminDashboard()" style="background:#3b82f6; color:white; padding:8px 15px; border-radius:8px;">ğŸ”™ Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ø³Ø§ÛŒØª</button>
                <button onclick="logoutAdmin()" style="background:#ef4444; color:white; padding:8px 15px; border-radius:8px;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
            </div>
        </div>
        <div class="container" style="padding-top:30px;">
            <div class="grid" style="margin-bottom:30px;">
                <div class="card" style="padding:20px; text-align:center;">
                    <div style="font-size:2.5em; font-weight:900; color:var(--primary);" id="statActivities">0</div>
                    <p>Ú†Ø§Ù„Ø§Ú©ÛŒ</p>
                </div>
                <div class="card" style="padding:20px; text-align:center;">
                    <div style="font-size:2.5em; font-weight:900; color:var(--primary);" id="statTeachers">0</div>
                    <p>Ù…Ø§Ù…Û†Ø³ØªØ§</p>
                </div>
            </div>

            <div class="nav-pills">
                <button onclick="switchAdminTab('activities')" id="tab-admin-acts" class="pill active">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†</button>
                <button onclick="switchAdminTab('teachers')" id="tab-admin-teach" class="pill">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†</button>
            </div>

            <div id="adminActivitiesView" class="glass" style="padding:20px; background:var(--bg-card);">
                <table style="width:100%; border-collapse:collapse;">
                    <thead><tr style="text-align:right; border-bottom:2px solid #eee;"><th>Ø¨Ø§Ø¨Û•Øª</th><th>Ù…Ø§Ù…Û†Ø³ØªØ§</th><th>Ú©Ø±Ø¯Ø§Ø±</th></tr></thead>
                    <tbody id="adminActivitiesTable"></tbody>
                </table>
            </div>

            <div id="adminTeachersView" class="glass" style="padding:20px; display:none; background:var(--bg-card);">
                <button onclick="openAddTeacherModal()" class="admin-link-btn" style="background:var(--primary); color:white; margin-bottom:20px;">â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</button>
                <div id="adminTeachersGrid" class="teacher-grid"></div>
            </div>
        </div>
    </div>

    <div id="editorModal" class="modal-overlay">
        <div class="editor-container">
            <div class="editor-toolbar">
                <button onclick="closeEditor()" style="color:#ef4444; font-weight:bold;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
                <div style="display:flex; gap:10px;">
                    <button onclick="setLayout('landscape')" style="background:#334155; padding:5px 10px; border-radius:5px;">ÙˆÛÙ†Û•ÛŒ Ù¾Ø§Ù†</button>
                    <button onclick="setLayout('portrait')" style="background:#334155; padding:5px 10px; border-radius:5px;">ÙˆÛÙ†Û•ÛŒ Ø¯Ø±ÛÚ˜</button>
                </div>
                <div style="display:flex; gap:10px;">
                    <button onclick="window.print()" style="background:white; color:black; padding:5px 10px; border-radius:5px;">ğŸ–¨ï¸</button>
                    <button onclick="saveToArchive()" id="btnSaveArchive" style="background:var(--primary); color:white; padding:5px 15px; border-radius:5px;">ğŸ’¾ Ø³Û•ÛŒÚ¤</button>
                </div>
            </div>

            <div class="paper-area">
                <div class="a4-page" id="reportPaper">
                    <div class="p-header">
                        <div><h1 style="font-size:24px; color:black; margin:0;">Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</h1><p style="color:#666; margin-top:5px;">ÙÛ†Ø±Ù…ÛŒ Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ</p></div>
                        <div style="width:60px; height:60px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">LOGO</div>
                    </div>
                    <div class="p-form">
                        <div><label style="font-size:12px; color:#666;">Ø¨Ø§Ø¨Û•Øª</label><input id="inpName" class="p-input"></div>
                        <div><label style="font-size:12px; color:#666;">Ù„ÛŒÚ˜Ù†Û•</label><input id="inpComm" class="p-input"></div>
                        <div><label style="font-size:12px; color:#666;">Ù…Ø§Ù…Û†Ø³ØªØ§</label><select id="inpTeacher" class="p-input" style="background:white;"><option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</option></select></div>
                        <div><label style="font-size:12px; color:#666;">Ø¨Û•Ø±ÙˆØ§Ø±</label><input id="inpDate" type="date" class="p-input"></div>
                    </div>
                    <textarea id="inpNotes" style="width:100%; height:120px; border:1px solid #ddd; padding:10px; resize:none; font-family:inherit; margin-bottom:10px;" placeholder="ØªÛØ¨ÛŒÙ†ÛŒ..."></textarea>
                    <div id="imgContainer" class="p-images landscape">
                        <div class="slot" id="slot0" onmousedown="startDrag(event, 0)" ontouchstart="startDrag(event, 0)">
                            <img id="img0">
                            <div class="controls"><div class="c-btn" onclick="triggerFile(0)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(0, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(0, -0.1)">-</div></div>
                        </div>
                        <div class="slot" id="slot1" onmousedown="startDrag(event, 1)" ontouchstart="startDrag(event, 1)">
                            <img id="img1">
                            <div class="controls"><div class="c-btn" onclick="triggerFile(1)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(1, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(1, -0.1)">-</div></div>
                        </div>
                        <div class="slot" id="slot2" onmousedown="startDrag(event, 2)" ontouchstart="startDrag(event, 2)">
                            <img id="img2">
                            <div class="controls"><div class="c-btn" onclick="triggerFile(2)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(2, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(2, -0.1)">-</div></div>
                        </div>
                        <div class="slot" id="slot3" onmousedown="startDrag(event, 3)" ontouchstart="startDrag(event, 3)">
                            <img id="img3">
                            <div class="controls"><div class="c-btn" onclick="triggerFile(3)">ğŸ“‚</div><div class="c-btn" onclick="adjustZoom(3, 0.1)">+</div><div class="c-btn" onclick="adjustZoom(3, -0.1)">-</div></div>
                        </div>
                    </div>
                    <div style="margin-top:auto; text-align:center; font-size:12px; color:#999; border-top:1px solid #eee; padding-top:10px;">Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯ÛŒ Ø¦ÛŒÙ†Ú¯Ù„ÛŒØ²ÛŒ Ù†Ø§Ø­Ú©ÙˆÙ…ÛŒ</div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="hiddenFileInput" accept="image/*" style="display:none;">
    <div id="teacherModal" class="modal-overlay" style="z-index:9100; align-items:center; justify-content:center;">
        <div class="glass" style="background:white; padding:30px; width:90%; max-width:400px;">
            <h3>Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</h3>
            <input id="newTeacherName" type="text" class="search-input" style="border:1px solid #ddd; margin:15px 0;" placeholder="Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§">
            <button onclick="saveNewTeacher()" class="admin-link-btn" style="width:100%; justify-content:center; background:var(--primary); color:white;">Ø³Û•ÛŒÚ¤</button>
            <button onclick="document.getElementById('teacherModal').style.display='none'" style="margin-top:10px; width:100%;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
        </div>
    </div>
    <div id="photoModal" class="modal-overlay" style="z-index:9100; align-items:center; justify-content:center;">
        <div class="glass" style="background:white; padding:30px; width:90%; max-width:400px;">
            <input type="file" id="teacherPhotoInput" style="display:none;" onchange="handleTeacherPhotoSelect(this)">
            <button onclick="document.getElementById('teacherPhotoInput').click()" class="admin-link-btn" style="width:100%; justify-content:center; background:var(--primary); color:white; margin-bottom:10px;">Ù‡Û•ÚµØ¨Ú˜Ø§Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•</button>
            <button onclick="document.getElementById('photoModal').style.display='none'" style="width:100%;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy, updateDoc, where } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        
        const IMGBB_API_KEY = "0792200cd18a10eadeeccf373d03e4f7"; 

        // !!! Ù„ÛØ±Û• Ú©Û†Ø¯ÛŒ ÙØ§ÛŒÛ•Ø±Ø¨Û•ÛŒØ³ Ø¯Ø§Ø¨Ù†Û !!!
        const firebaseConfig = {
            apiKey: "AIzaSyAr_JHCa5BbM5RJ9KCp0IBom1rdAgVX4CM",
            authDomain: "gzng-f4273.firebaseapp.com",
            projectId: "gzng-f4273",
            storageBucket: "gzng-f4273.firebasestorage.app",
            messagingSenderId: "417779309632",
            appId: "1:417779309632:web:6ed119d26baa35822cd3a5",
            measurementId: "G-B6V0CHGQV6"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const actRef = collection(db, "activities");
        const teachRef = collection(db, "teachers");

        let acts=[], teachers=[], user=null;
        window.localFiles=[null,null,null,null]; window.currentSlot=0;
        window.imgState={0:{s:1,x:0,y:0},1:{s:1,x:0,y:0},2:{s:1,x:0,y:0},3:{s:1,x:0,y:0}};
        let teacherPhotoTarget=null, currentFilter=null;

        // --- THEME ---
        window.toggleTheme = () => {
            const html = document.documentElement;
            const next = html.getAttribute('data-theme')==='dark'?'light':'dark';
            html.setAttribute('data-theme',next); localStorage.setItem('theme',next);
            document.getElementById('themeIcon').innerText = next==='dark'?'â˜€ï¸':'ğŸŒ™';
        };
        const saved = localStorage.getItem('theme')||'light';
        document.documentElement.setAttribute('data-theme',saved);
        document.getElementById('themeIcon').innerText = saved==='dark'?'â˜€ï¸':'ğŸŒ™';

        // --- AUTH ---
        onAuthStateChanged(auth, (u) => {
            user = u;
            const btn = document.getElementById('adminBtn');
            const addBtn = document.getElementById('btnAddActivity');
            if(u){
                btn.innerHTML=`<span>âš™ï¸</span> Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯`; btn.style.background="var(--primary)"; btn.style.color="white";
                btn.onclick=openAdminDashboard;
                addBtn.style.display='flex';
            } else {
                btn.innerHTML=`<span>ğŸ”‘</span> Ø¦Û•Ø¯Ù…ÛŒÙ†`; btn.style.background="rgba(128,128,128,0.1)"; btn.style.color="var(--text-main)";
                btn.onclick=()=>document.getElementById('adminAuthModal').style.display='flex';
                addBtn.style.display='none';
            }
        });
        window.loginAdmin=async()=>{
            try{await signInWithEmailAndPassword(auth,document.getElementById('adminEmail').value,document.getElementById('adminPass').value); document.getElementById('adminAuthModal').style.display='none';}
            catch(e){alert(e.message);}
        };
        window.logoutAdmin=async()=>{if(confirm("Ø¯Û•Ø±Ú†ÙˆÙˆÙ†ØŸ")){await signOut(auth); closeAdminDashboard();}};

        // --- DATA ---
        onSnapshot(query(actRef, orderBy("date", "desc")), (s) => {
            acts = s.docs.map(d=>({id:d.id, ...d.data()}));
            renderApp(); renderAdminContent();
        });
        onSnapshot(teachRef, (s) => {
            teachers = s.docs.map(d=>({id:d.id, ...d.data()}));
            updateDropdown(); renderApp(); renderAdminContent();
        });

        function updateDropdown(){
            const s=document.getElementById('inpTeacher'); const v=s.value; s.innerHTML='<option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</option>';
            teachers.forEach(t=>{const o=document.createElement('option'); o.value=t.name; o.text=t.name; s.appendChild(o)}); s.value=v;
        }

        function renderApp(){
            if(currentFilter) { renderFilter(); return; }
            const term = document.getElementById('searchBox').value.toLowerCase();
            const list = acts.filter(a=>a.name.toLowerCase().includes(term)||a.teacher.toLowerCase().includes(term));
            
            document.getElementById('activitiesGrid').innerHTML = list.map(a => `
                <div class="card">
                    <div class="card-img-grid">${(a.images||[]).slice(0,4).map(u=>`<img src="${u}">`).join('')}</div>
                    <div class="card-body">
                        <div class="card-title">${a.name}</div>
                        <div class="card-info">ğŸ“… ${a.date} | ğŸ‘¤ ${a.teacher}</div>
                    </div>
                    <div class="card-footer"><button class="btn-card" onclick="viewReport('${a.id}')">ğŸ“„ Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú•Ø§Ù¾Û†Ø±Øª</button></div>
                </div>
            `).join('');

            const tMap={}; acts.forEach(a=>tMap[a.teacher]=(tMap[a.teacher]||0)+1);
            document.getElementById('teachersGrid').innerHTML = teachers.map(t => `
                <div class="teacher-item" onclick="filterT('${t.name}')">
                    <img src="${t.photo||'https://via.placeholder.com/100'}" class="avatar-lg">
                    <div style="font-weight:bold;">${t.name}</div>
                    <div style="color:gray; font-size:0.8em;">${tMap[t.name]||0} Ú†Ø§Ù„Ø§Ú©ÛŒ</div>
                </div>
            `).join('');
        }

        window.filterT=(n)=>{currentFilter=n; switchView('archive');};
        function renderFilter(){
            document.getElementById('archiveControls').style.display='none';
            document.getElementById('filterHeader').style.display='flex';
            document.getElementById('filterName').innerText=currentFilter;
            const m=teachers.find(t=>t.name===currentFilter);
            document.getElementById('filterAvatarContainer').innerHTML=`<img src="${(m&&m.photo)?m.photo:'https://via.placeholder.com/50'}" style="width:50px;height:50px;border-radius:50%;">`;
            const list=acts.filter(a=>a.teacher===currentFilter);
            document.getElementById('activitiesGrid').innerHTML=list.map(a=>`
                <div class="card">
                    <div class="card-img-grid">${(a.images||[]).slice(0,4).map(u=>`<img src="${u}">`).join('')}</div>
                    <div class="card-body"><div class="card-title">${a.name}</div><div class="card-info">ğŸ“… ${a.date}</div></div>
                    <div class="card-footer"><button class="btn-card" onclick="viewReport('${a.id}')">ğŸ“„ Ú•Ø§Ù¾Û†Ø±Øª</button></div>
                </div>
            `).join('');
        }
        window.clearFilter=()=>{currentFilter=null; document.getElementById('filterHeader').style.display='none'; document.getElementById('archiveControls').style.display='block'; renderApp();}
        
        window.switchView=(v)=>{
            document.getElementById('activitiesGrid').style.display=v==='archive'?'grid':'none';
            document.getElementById('teachersGrid').style.display=v==='teachers'?'grid':'none';
            document.getElementById('btn-archive').classList.toggle('active',v==='archive');
            document.getElementById('btn-teachers').classList.toggle('active',v==='teachers');
            document.getElementById('archiveControls').style.display=(v==='archive'&&!currentFilter)?'block':'none';
        };
        document.getElementById('searchBox').addEventListener('input',renderApp);

        // --- ADMIN DASHBOARD ---
        window.openAdminDashboard=()=>{document.getElementById('adminDashboard').style.display='block'; renderAdminContent();};
        window.closeAdminDashboard=()=>{document.getElementById('adminDashboard').style.display='none';};
        
        function renderAdminContent(){
            if(!user) return;
            document.getElementById('statActivities').innerText=acts.length;
            document.getElementById('statTeachers').innerText=teachers.length;
            document.getElementById('adminActivitiesTable').innerHTML=acts.map(a=>`
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:15px;">${a.name}</td>
                    <td>${a.teacher}</td>
                    <td>
                        <button onclick="viewReport('${a.id}')" style="color:blue;">ğŸ“„</button>
                        <button onclick="delItem('${a.id}')" style="color:red; margin-right:10px;">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
            document.getElementById('adminTeachersGrid').innerHTML=teachers.map(t=>`
                <div class="teacher-item" style="cursor:default;">
                    <img src="${t.photo||'https://via.placeholder.com/50'}" class="avatar-lg">
                    <div>${t.name}</div>
                    <div style="margin-top:10px;">
                        <button onclick="editTName('${t.name}','${t.id}')">âœï¸</button>
                        <button onclick="openPhotoModal('${t.name}')">ğŸ“·</button>
                        <button onclick="delTProfile('${t.name}')" style="color:red;">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }
        window.switchAdminTab=(t)=>{
            document.getElementById('adminActivitiesView').style.display=t==='activities'?'block':'none';
            document.getElementById('adminTeachersView').style.display=t==='teachers'?'block':'none';
            document.getElementById('tab-admin-acts').classList.toggle('active',t==='activities');
            document.getElementById('tab-admin-teach').classList.toggle('active',t==='teachers');
        }

        // --- EDITOR & LOGIC ---
        window.openEditor=()=>{
            ['inpName','inpComm','inpTeacher','inpDate','inpNotes'].forEach(i=>document.getElementById(i).value='');
            document.getElementById('inpDate').value=new Date().toISOString().split('T')[0];
            window.localFiles=[null,null,null,null];
            for(let i=0;i<4;i++){const el=document.getElementById('img'+i); el.src=''; window.imgState[i]={s:1,x:0,y:0}; el.style.transform='scale(1)';}
            enableEdit(true); document.getElementById('editorModal').classList.add('active');
        };
        window.closeEditor=()=>document.getElementById('editorModal').classList.remove('active');
        window.viewReport=(id)=>{
            const a=acts.find(x=>x.id===id); if(!a)return;
            document.getElementById('editorModal').classList.add('active');
            document.getElementById('inpName').value=a.name; document.getElementById('inpComm').value=a.committee||'';
            document.getElementById('inpTeacher').value=a.teacher; document.getElementById('inpDate').value=a.date;
            document.getElementById('inpNotes').value=a.notes||'';
            for(let i=0;i<4;i++){
                const el=document.getElementById('img'+i); window.imgState[i]={s:1,x:0,y:0}; el.style.transform='scale(1)';
                if(a.images&&a.images[i])el.src=a.images[i]; else el.src='';
            }
            enableEdit(!!user);
        }
        function enableEdit(ok){
            ['inpName','inpComm','inpTeacher','inpDate','inpNotes'].forEach(i=>document.getElementById(i).disabled=!ok);
            document.getElementById('btnSaveArchive').style.display=ok?'inline-block':'none';
            document.querySelectorAll('.controls').forEach(c=>c.style.display=ok?'flex':'none');
        }

        async function upload(f){const d=new FormData();d.append("image",f); const r=await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`,{method:"POST",body:d}); const j=await r.json(); return j.data.url;}
        window.saveToArchive=async()=>{
            if(!user)return; const n=document.getElementById('inpName').value; const t=document.getElementById('inpTeacher').value;
            if(!n||!t){alert("Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ú©Û•Ù…Û•");return;} alert("Ú†Ø§ÙˆÛ•Ú•Û Ø¨Û•...");
            try{
                let u=[]; for(let i=0;i<4;i++)if(window.localFiles[i])u.push(await upload(window.localFiles[i]));
                await addDoc(actRef,{name:n,committee:document.getElementById('inpComm').value,teacher:t,date:document.getElementById('inpDate').value,notes:document.getElementById('inpNotes').value,images:u,createdAt:new Date()});
                alert("ØªÛ•ÙˆØ§Ùˆ"); closeEditor();
            }catch(e){alert("Ù‡Û•ÚµÛ•: "+e.message);}
        }
        
        window.triggerFile=(i)=>{if(document.getElementById('inpName').disabled)return; window.currentSlot=i; document.getElementById('hiddenFileInput').click();}
        document.getElementById('hiddenFileInput').addEventListener('change',e=>{const f=e.target.files[0]; if(f){window.localFiles[window.currentSlot]=f; const r=new FileReader(); r.onload=ev=>document.getElementById('img'+window.currentSlot).src=ev.target.result; r.readAsDataURL(f);} e.target.value='';});
        
        // Drag Zoom Logic Minified
        let isD=false,aI=0,sX=0,sY=0,iX=0,iY=0;
        window.startDrag=(e,i)=>{if(document.getElementById('inpName').disabled)return; isD=true; aI=i; const c=e.touches?e.touches[0]:e; sX=c.clientX; sY=c.clientY; iX=imgState[i].x; iY=imgState[i].y;};
        window.addEventListener('mousemove',e=>{if(!isD)return; e.preventDefault(); upD(e.clientX-sX,e.clientY-sY)});
        window.addEventListener('touchmove',e=>{if(!isD)return; upD(e.touches[0].clientX-sX,e.touches[0].clientY-sY)},{passive:false});
        window.addEventListener('mouseup',()=>isD=false); window.addEventListener('touchend',()=>isD=false);
        function upD(dx,dy){const s=imgState[aI]; s.x=iX+dx; s.y=iY+dy; tr(aI);}
        window.adjustZoom=(i,v)=>{imgState[i].s=Math.max(0.1,imgState[i].s+v); tr(i);}
        function tr(i){const s=imgState[i]; document.getElementById('img'+i).style.transform=`translate(${s.x}px,${s.y}px) scale(${s.s})`;}

        window.setLayout=(t)=>document.getElementById('imgContainer').className=`p-images ${t}`;
        window.delItem=async(id)=>{if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØªØŸ"))await deleteDoc(doc(db,"activities",id));};
        
        window.openAddTeacherModal=()=>document.getElementById('teacherModal').style.display='flex';
        window.saveNewTeacher=async()=>{const n=document.getElementById('newTeacherName').value; if(n)await addDoc(teachRef,{name:n,photo:""}); document.getElementById('teacherModal').style.display='none';};
        window.openPhotoModal=(n)=>{teacherPhotoTarget=n; document.getElementById('photoModal').style.display='flex';};
        window.handleTeacherPhotoSelect=async(input)=>{const f=input.files[0]; if(f){const u=await upload(f); const m=teachers.find(t=>t.name===teacherPhotoTarget); if(m)await updateDoc(doc(db,"teachers",m.id),{photo:u}); document.getElementById('photoModal').style.display='none';}};
        window.delTProfile=async(n)=>{const m=teachers.find(t=>t.name===n); if(m&&confirm("Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ"))await deleteDoc(doc(db,"teachers",m.id));};
        window.editTName=async(oldN,id)=>{const newN=prompt("Ù†Ø§ÙˆÛŒ Ù†ÙˆÛ",oldN); if(newN&&newN!==oldN){const b=writeBatch(db); b.update(doc(db,"teachers",id),{name:newN}); const q=await getDocs(query(actRef,where("teacher","==",oldN))); q.forEach(d=>b.update(d.ref,{teacher:newN})); await b.commit(); alert("ØªÛ•ÙˆØ§Ùˆ");}};

    </script>
    <script>function checkSitePassword(){if(document.getElementById('sitePassword').value==="2526"){document.getElementById('securityOverlay').style.display='none'; document.getElementById('mainContent').style.display='block';}else{document.getElementById('errorMsg').style.display='block';}}</script>
</body>
</html>
